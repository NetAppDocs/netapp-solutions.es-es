---
sidebar: sidebar 
permalink: databases/azure_ora_nfile_protection.html 
summary: En esta sección se describe cómo proteger su base de datos de Oracle con la herramienta azacsnap y el backup de snapshots, la restauración y las snapshots en niveles en Azure BLOB. 
keywords: Oracle, Azure, database, backup, restore 
---
= Proteja su base de datos de Oracle en el cloud de Azure
:hardbreaks:
:allow-uri-read: 
:nofooter: 
:icons: font
:linkattrs: 
:table-stripes: odd
:imagesdir: ./../media/


link:azure_ora_nfile_procedures.html["Anterior: Procedimientos de implantación."]

[role="lead"]
Autor(es): Allen Cao, ingeniería de soluciones NetApp



== Realizar backups de bases de datos de Oracle con snapshot mediante la herramienta AzAcSnap

La herramienta Snapshot coherente con las aplicaciones de Azure (AzAcSnap) es una herramienta de línea de comandos que permite la protección de datos de bases de datos de terceros al manejar toda la orquestación necesaria para ponerlas en un estado coherente con las aplicaciones antes de tomar una instantánea de almacenamiento, después de la cual devuelve las bases de datos a un estado operativo.

En el caso de Oracle, se coloca la base de datos en modo de backup para realizar una instantánea y, a continuación, sacar la base de datos del modo de backup.



=== Backup de datos y volúmenes de registros

El backup se puede configurar en el host del servidor de bases de datos con un script de shell simple que ejecuta el comando snapshot. A continuación, se puede programar la ejecución del script desde crontab.

Generalmente, la frecuencia de backup depende del objetivo de tiempo de recuperación y el objetivo de punto de recuperación que desee. La creación frecuente de copias Snapshot consume más espacio de almacenamiento. Existe un compensación entre la frecuencia de backup y el consumo de espacio.

Los volúmenes de datos suelen consumir más espacio de almacenamiento que los volúmenes de registro. Por lo tanto, se pueden realizar copias Snapshot en volúmenes de datos cada pocas horas y realizar copias Snapshot más frecuentes en volúmenes de registro cada 15 a 30 minutos.

Consulte los siguientes ejemplos de secuencias de comandos y programación de backup.

Para snapshots de volumen de datos:

[source, cli]
----
 # /bin/sh
cd /home/azacsnap/bin
. ~/.bash_profile
azacsnap -c backup --volume data --prefix acao-ora01-data --retention 36
azacsnap -c backup --volume other --prefix acao-ora01-log --retention 250
----
Para las copias de Snapshot de volumen de registro:

[source, cli]
----
 # /bin/sh
cd /home/azacsnap/bin
. ~/.bash_profile
azacsnap -c backup --volume other --prefix acao-ora01-log --retention 250
----
68b7e37ef318c0e56eabf3e1aded4216


NOTE: Al configurar el backup `azacsnap.json` archivo de configuración, agregar todos los volúmenes de datos, incluido el volumen binario a. `dataVolume` y todos los volúmenes de registro en `otherVolume`. La retención máxima de copias de Snapshot es de 250 copias.



=== Validar las copias Snapshot

Vaya al portal de Azure > Azure NetApp Files/Volumes para comprobar si las snapshots se han creado correctamente.

image:db_ora_azure_anf_snap_01.PNG["Esta captura de pantalla muestra dos archivos en la lista de instantáneas."]
image:db_ora_azure_anf_snap_02.PNG["Esta captura de pantalla muestra ocho archivos en la lista de instantáneas."]



== Recuperación y restauración de Oracle desde un backup local

Una de las ventajas clave del backup snapshot es que existe de forma conjunta con los volúmenes de base de datos de origen y que los volúmenes de base de datos primaria pueden revertirse casi instantáneamente.



=== Restauración y recuperación de Oracle en el servidor primario

El siguiente ejemplo muestra cómo restaurar y recuperar una base de datos de Oracle desde la consola de Azure y la CLI en el mismo host de Oracle.

. aa30a622663e0f34541394e008fe82cd
+
ea16560565f3889db4dabf938628b462

+
Copyright (c) 1982, 2019, Oracle. Todos los derechos reservados.

+
Conectado a: Base de datos Oracle 19c Enterprise Edition Versión 19.0.0.0.0 - Versión de producción 19.8.0.0.0

+
0409b2fce118cc126a532dea158d2943

+
bec6da77877c0793c1d3eb6c6896e98e

+
a5b83945adfd5370663cb2d9c4f31d09

+
6ba18fa8fa7d170dfd8fc80f0f3d39f7

+
d1d2dcb121f8bf8fd39724ea075c6409

+
a92090dde5e820fde0a68705ee3f2bd0

+
fd9736dfc88a182f9cb6e5f6a2b97487

+
 ID
+
[listing]
----
EVENT
--------------------------------------------------------------------------------
DT
---------------------------------------------------------------------------
         1
insert a data marker to validate snapshot restore
12-SEP-22 07.07.35.000000 PM
----
. Coloque la tabla después de los backups de Snapshot.
+
07b56c53a9fec8c477afb0cb5f2394af

+
dcd4d50ecf59b4752c161f0ddc44df44

+
Copyright (c) 1982, 2019, Oracle. Todos los derechos reservados.

+
Conectado a: Base de datos Oracle 19c Enterprise Edition Versión 19.0.0.0.0 - Versión de producción 19.8.0.0.0

+
bee0f13528c2f6f5b67053dc1e942328

+
cd85f26775e453b2177d5fcc6265b31d

+
07e18ec921a195478cdbab47d8d68d89

+
f06f4fbf6e3e0e45b0d4b241ceaf19c9

. En la consola de Azure NetApp Files, restaure el volumen de registro a la última snapshot disponible. Seleccione *volumen de reversión*.
+
image:db_ora_azure_anf_restore_01.PNG["Esta captura de pantalla muestra el método de reversión de instantánea para volúmenes en el panel ANF."]

. Confirme la reversión de volumen y haga clic en *revertir* para completar la reversión del volumen a la última copia de seguridad disponible.
+
image:db_ora_azure_anf_restore_02.PNG["El \"¿está seguro de que desea hacer esto?\" página para la nueva versión de instantánea."]

. Repita los mismos pasos para el volumen de datos y compruebe que el backup contenga la tabla que se va a recuperar.
+
image:db_ora_azure_anf_restore_03.PNG["Esta captura de pantalla muestra el método de reversión de instantánea para volúmenes de datos en el panel ANF."]

. Vuelva a confirmar la versión del volumen y haga clic en "Revert".
+
image:db_ora_azure_anf_restore_04.PNG["El \"¿está seguro de que desea hacer esto?\" página para la reversión de la copia de snapshot de volumen de datos."]

. Resincronizcar los archivos de control si tiene varias copias de ellos y reemplazar el archivo de control antiguo con la última copia disponible.
+
952cd3804f479f3c31f123d064ccbdf5

. Inicie sesión en el equipo virtual del servidor de Oracle y ejecute la recuperación de bases de datos con sqlplus.
+
07b56c53a9fec8c477afb0cb5f2394af

+
125ab5cbfb90c4a6d038bcca4da6fdc4

+
Copyright (c) 1982, 2019, Oracle. Todos los derechos reservados.

+
010621501012cd31b6666d17dad683d2

+
6bd3f70e5ab38ca26f8cabd390e15fc0

+
424459a4363a5afdd1e45d31fcd11efe

+
db9afd3f7adaff3fe1135208fa6b6a09

+
abc467423916c8ee7c16f566b4ab4ca8

+
db9afd3f7adaff3fe1135208fa6b6a09

+
479d2dfa77fdcde3bfd41fcdebbca1ff

+
db9afd3f7adaff3fe1135208fa6b6a09

+
c76ff2f7e10a42adf7faec8f9e6faeab

+
0e98028493ec8c4a1d181c0d71c3ec7b

+
f6c9ea366c01da7d664a8c7c3813e0bd

+
fd9736dfc88a182f9cb6e5f6a2b97487

+
 ID
+
[listing]
----
EVENT
--------------------------------------------------------------------------------
DT
---------------------------------------------------------------------------
         1
insert a data marker to validate snapshot restore
12-SEP-22 07.07.35.000000 PM


SQL> select systimestamp from dual;

 SYSTIMESTAMP
---------------------------------------------------------------------------
13-SEP-22 03.28.52.646977 PM +00:00
----


Esta pantalla muestra que la tabla borrada se ha recuperado utilizando copias de seguridad de instantánea locales.

link:azure_ora_nfile_migration.html["Siguiente: Migración de bases de datos."]

---
sidebar: sidebar 
permalink: databases/vcf_ora_rac_vvol.html 
keywords: Database, Oracle, AWS, FSx ONTAP, VMC, VMware 
summary: 'La solución ofrece una descripción general y detalles de la implementación y la protección de Oracle en VMware Cloud Foundation (VCF) con vSphere Virtual Volumes (vVols) como almacenamiento de bases de datos principal y la configuración de RAC (Base de datos de Oracle en Real Application Clusters).' 
---
= TR-4997: Implementación y protección de Oracle RAC en VCF con vVols
:hardbreaks:
:allow-uri-read: 
:nofooter: 
:icons: font
:linkattrs: 
:imagesdir: ../media/


Allen Cao, Niyaz Mohamed, NetApp

[role="lead"]
La solución ofrece una descripción general y detalles de la implementación y la protección de Oracle en VMware Cloud Foundation (VCF) con vSphere Virtual Volumes (vVols) como almacenamiento de bases de datos principal y la configuración de RAC (Base de datos de Oracle en Real Application Clusters).



== Específico

VMware vSphere Virtual Volumes (vVols) es un marco de gestión e integración de SAN/NAS que expone los discos virtuales como objetos de almacenamiento nativos y posibilita las operaciones basadas en cabinas en los discos virtuales. En otras palabras, vVols hace que los dispositivos SAN/NAS sepan equipos virtuales y libera la capacidad de aprovechar los servicios de datos basados en arreglos con un método centrado en VM con la granularidad de un único disco virtual. VVols permite a los clientes aprovechar las exclusivas funcionalidades de su inversión actual en almacenamiento y realizar una transición sin interrumpir el servicio a un modelo operativo más simple y eficiente optimizado para entornos virtuales que funcionan en todos los tipos de almacenamiento.

En link:https://docs.netapp.com/us-en/netapp-solutions/databases/vcf_ora_si_vvol.html["TR-4996"^], demostramos la implementación y la protección de bases de datos Oracle en una instancia única en VCF con vVols. Esta documentación muestra la puesta en marcha y la protección de una base de datos Oracle RAC en un entorno VMware Cloud Foundation con vVols como almacenamiento de base de datos principal en un clúster de almacenamiento de NetApp ONTAP. La base de datos de Oracle RAC se configura como si se implementara en sistemas de archivos locales en un sistema de almacenamiento local. Este informe técnico se centra en los pasos para crear vVols en VCF para la implementación de Oracle RAC. También mostramos la puesta en marcha de la base de datos RAC de Oracle en VCF en vVols con el kit de herramientas de automatización de NetApp y la protección de base de datos de RAC con la herramienta UI de NetApp SnapCenter.

Esta solución aborda los siguientes casos prácticos:

* Implementación de la base de datos de Oracle RAC en VCF con almacén de datos vVols en NetApp ONTAP AFF como almacenamiento de base de datos primario
* Backup y restauración de bases de datos de Oracle en VCF con almacén de datos vVols mediante la herramienta IU de NetApp SnapCenter




== Destinatarios

Esta solución está dirigida a las siguientes personas:

* Un administrador de bases de datos que desea implementar Oracle RAC en VCF con almacén de datos vVols en NetApp ONTAP AFF como almacenamiento de base de datos principal
* Un arquitecto de la solución de base de datos que desee probar las cargas de trabajo de Oracle RAC en VCF con un almacén de datos vVols en almacenamiento de NetApp ONTAP AFF
* Administrador de almacenamiento que desea poner en funcionamiento y gestionar una base de datos Oracle RAC desplegada en VCF con un almacén de datos vVols en un sistema de almacenamiento NetApp ONTAP AFF
* Propietario de aplicación que desea poner en marcha una base de datos de Oracle RAC en VCF con almacén de datos VVol




== Entorno de prueba y validación de la solución

Las pruebas y la validación de esta solución se realizaron en un entorno de laboratorio en VCF con un almacén de datos vVols en un almacenamiento de NetApp ONTAP AFF que podría no coincidir con el entorno de puesta en marcha final. Para obtener más información, consulte la sección <<Factores clave a tener en cuenta la puesta en marcha>>.



=== Arquitectura

image:vcf_orarac_vvol_architecture.png["Esta imagen proporciona una imagen detallada de la configuración de la puesta en marcha de Oracle en el cloud público de AWS con iSCSI y ASM."]



=== Componentes de hardware y software

[cols="33%, 33%, 33%"]
|===


3+| *Hardware* 


| NetApp ONTAP AFF A300 | Versión 9.14.1P4 | Bandeja DS224 con 24 discos NVMe, capacidad total de 35,2 TiB 


| Clúster de VMware vSphere | Versión 8,02 | 12 CPU(s) x Intel(R) Xeon(R) Gold 5218 CPU a 2,30GHz GHz, 8 nodos (4 dominios de gestión y 4 dominios de carga de trabajo) 


3+| *Software* 


| Red Hat Linux | Kernel RHEL-8,6, 4.18.0-372,9.1.el8.x86_64 | Alojamiento de servidores Oracle DB, suscripción de RedHat implementada para pruebas 


| Servidor Windows Server | 2022 Estándar, 10.0.20348 Construcción 20348 | Hospedando servidor SnapCenter 


| CentOS de Linux | CentOS Linux versión 8.5.2111 | Alojando controladora Ansible 


| Infraestructura de Grid de Oracle | Versión 19.18 | Parche RU aplicado p34762026_190000_Linux-x86-64.zip 


| Base de datos Oracle | Versión 19.18 | Parche RU aplicado p34765931_190000_Linux-x86-64.zip 


| Oracle OPatch | Versión 12.2.0.1.36 | Último parche p6880880_190000_Linux-x86-64.zip 


| Servidor SnapCenter | Versión 6,0 | Implementación de grupos de trabajo 


| Plugin de SnapCenter para VMware vSphere | Versión 6,0 | Se implementa como una máquina virtual de OVA en clúster de vSphere 


| Herramienta ONTAP para VMware vSphere | Versión 9,13 | Se implementa como una máquina virtual de OVA en clúster de vSphere 


| Abra JDK | Versión java-11-openjdk-11,0.23,0.9-3.el8.x86_64 | Requisito de complemento de SnapCenter en equipos virtuales de bases de datos 
|===


=== Configuración de la base de datos de Oracle RAC en VCF

[cols="33%, 33%, 33%"]
|===


3+|  


| * Nodo RAC* | *Base de datos* | *Almacenamiento de DB* 


| ora01 | NTAP(NTAP_pdb1,NTAP_pdb2,NTAP_pdb3) | ALMACENES DE DATOS VVOLS (VCF_ORA_BINS, VCF_ORA_CRS, VCF_ORA_DAT1, VCF_ORA_DAT2, VCF_ORA_LOGS) EN NetApp ONTAP AFF A300 


| ora02 | NTAP(NTAP_pdb1,NTAP_pdb2,NTAP_pdb3) | ALMACENES DE DATOS VVOLS (VCF_ORA_BINS, VCF_ORA_CRS, VCF_ORA_DAT1, VCF_ORA_DAT2, VCF_ORA_LOGS) EN NetApp ONTAP AFF A300 
|===


=== Factores clave a tener en cuenta la puesta en marcha

* *Protocolo para vVols a conectividad de clúster ONTAP.* NFS o iSCSI son buenas opciones. Los niveles de rendimiento son equivalentes. En esta demostración de la solución, utilizamos iSCSI como protocolo de almacenamiento para la conectividad vVols con el cluster de almacenamiento subrayado de ONTAP. Si la infraestructura VCF admite, también se admiten los protocolos FC/FCoE, NVMe/FC para los almacenes de datos vVols en NetApp ONTAP.
* *Diseño de almacenamiento de Oracle en vVols datastores.* En nuestras pruebas y validaciones, implementamos cinco almacenes de datos vVols para archivos binarios de Oracle, registro/voto de cluster de Oracle, datos de Oracle y archivos de registro de Oracle. Es buena práctica separar diferentes tipos de archivos de Oracle en sus propios almacenes de datos, de modo que los procesos de backup, recuperación o clonado de la base de datos se puedan gestionar y ejecutar fácilmente. Cree vVols dedicados para grandes bases de datos y comparta vVols para bases de datos más pequeñas o bases de datos con un perfil de QoS similar. 
* *Redundancia de almacenamiento de Oracle.* Se utiliza `Normal Redundancy` para archivos críticos de registro/voto de cluster de Oracle RAC de modo que tres archivos de voto en tres grupos de fallos de disco de ASM proporcionen una protección de cluster óptima y el registro de cluster se duplique entre los grupos de fallos de disco de ASM. Se `External Redundancy` utiliza para archivos binarios, de datos y de registro de Oracle para optimizar el uso del almacenamiento. El RAID-DP de ONTAP subrayado proporciona protección de datos cuando `External Redundancy` se utiliza.
* *Credencial para autenticación de almacenamiento ONTAP.* Use solamente credenciales en el nivel del clúster de ONTAP para la autenticación del clúster de almacenamiento de ONTAP, incluida la conectividad de SnapCenter con el clúster de almacenamiento de ONTAP o la conectividad de la herramienta ONTAP con el clúster de almacenamiento de ONTAP.
* *Provisión de almacenamiento desde vVols datastore a la base de datos VM.* Agregue solo un disco a la vez a la máquina virtual de base de datos desde el almacén de datos vVols. No se admite actualmente la adición de varios discos desde almacenes de datos de vVols al mismo tiempo.  
* *Protección de base de datos.* NetApp ofrece una suite de software SnapCenter para realizar backups de bases de datos y restauraciones con una interfaz de interfaz de usuario intuitiva. NetApp recomienda implantar esta herramienta de gestión para conseguir una rápida copia de seguridad de instantáneas y una rápida restauración y recuperación de la base de datos.




== Puesta en marcha de la solución

En las siguientes secciones se ofrecen procedimientos paso a paso para el despliegue de la base de datos Oracle 19C en VCF con almacenes de datos vVols en el almacenamiento NetApp ONTAP en una configuración de Oracle RAC.



=== Requisitos previos para la implementación

[%collapsible]
====
La implementación requiere los siguientes requisitos previos.

. Se configuró una VCF de VMware. Para obtener información o instrucciones sobre cómo crear un VCF, consulte la documentación de VMware link:https://docs.vmware.com/en/VMware-Cloud-Foundation/index.html["Documentación de VMware Cloud Foundation"^].
. Aprovisione tres equipos virtuales de Linux, dos equipos virtuales para el clúster de base de datos de Oracle RAC y una máquina virtual para la controladora Ansible dentro del dominio de carga de trabajo de VCF. Aprovisionar un equipo virtual de servidor Windows para ejecutar el servidor NetApp SnapCenter. Para obtener información sobre la configuración del controlador Ansible para la implementación automatizada de bases de datos de Oracle, consulte los siguientes recursos link:https://docs.netapp.com/us-en/netapp-solutions/automation/getting-started.html["Primeros pasos con la automatización de soluciones de NetApp"^].
. Las máquinas virtuales de la base de datos Oracle RAC deben haber aprovisionado al menos dos interfaces de red: Una para la interconexión privada de Oracle RAC y otra para el tráfico de aplicaciones o datos públicos.
. El complemento de SnapCenter versión 6,0 para VMware vSphere se ha puesto en marcha en VCF. Consulte los siguientes recursos para el despliegue del plugin link:https://docs.netapp.com/us-en/sc-plugin-vmware-vsphere/["Documentación del plugin de SnapCenter para VMware vSphere"^]: .
. La herramienta ONTAP para VMware vSphere se ha puesto en marcha en VCF. Consulte los siguientes recursos para la implementación de la herramienta ONTAP para VMware vSphere: link:https://docs.netapp.com/us-en/ontap-tools-vmware-vsphere/index.html["Documentación de las herramientas de ONTAP para VMware vSphere"^]



NOTE: Asegúrese de haber asignado al menos 50g en el volumen raíz de Oracle VM para tener espacio suficiente para almacenar en zona intermedia los archivos de instalación de Oracle.

====


=== Crear un perfil de capacidad de almacenamiento

[%collapsible]
====
En primer lugar, cree un perfil de funcionalidad de almacenamiento personalizado para el almacenamiento ONTAP subrayado que aloja el almacén de datos vVols.

. Desde accesos directos del cliente de vSphere, abra la herramienta NetApp ONTAP. Compruebe que se haya agregado el clúster de almacenamiento de ONTAP `Storage Systems` como parte de la puesta en marcha de la herramienta ONTAP.
+
image:vcf_ora_vvol_scp_01.png["Captura de pantalla que muestra una configuración de perfil de funcionalidades de almacenamiento personalizada."] image:vcf_ora_vvol_scp_00.png["Captura de pantalla que muestra una configuración de perfil de funcionalidades de almacenamiento personalizada."]

. Haga clic `Storage capability profile` en para agregar un perfil personalizado para Oracle. Asigne un nombre al perfil y añada una breve descripción.
+
image:vcf_ora_vvol_scp_02.png["Captura de pantalla que muestra una configuración de perfil de funcionalidades de almacenamiento personalizada."]

. Elija la categoría de controladora de almacenamiento: Rendimiento, capacidad o híbrida.
+
image:vcf_ora_vvol_scp_03.png["Captura de pantalla que muestra una configuración de perfil de funcionalidades de almacenamiento personalizada."]

. Seleccione el protocolo.
+
image:vcf_ora_vvol_scp_04.png["Captura de pantalla que muestra una configuración de perfil de funcionalidades de almacenamiento personalizada."]

. Defina una política de calidad de servicio si lo desea.
+
image:vcf_ora_vvol_scp_05.png["Captura de pantalla que muestra una configuración de perfil de funcionalidades de almacenamiento personalizada."]

. Atributos de almacenamiento adicionales para el perfil. Asegúrese de que el cifrado está activado en la controladora NetApp si desea tener la capacidad de cifrado o puede causar problemas al aplicar el perfil.
+
image:vcf_ora_vvol_scp_06.png["Captura de pantalla que muestra una configuración de perfil de funcionalidades de almacenamiento personalizada."]

. Revise el resumen y termine la creación del perfil de funcionalidad de almacenamiento.
+
image:vcf_ora_vvol_scp_07.png["Captura de pantalla que muestra una configuración de perfil de funcionalidades de almacenamiento personalizada."]



====


=== Crear y configurar el almacén de datos de vVols

[%collapsible]
====
Una vez completados los requisitos previos, inicie sesión en VCF como usuario administrador a través del cliente vSphere, navegando al dominio de la carga de trabajo. No utilice la opción de almacenamiento incorporada de VMware para crear vVols. En su lugar, utilice la herramienta NetApp ONTAP para crear vVols. A continuación, se muestran los procedimientos para crear y configurar vVols.

. El flujo de trabajo de creación de vVols se puede activar desde la interfaz de la herramienta ONTAP o desde el clúster de dominio de carga de trabajo de VCF.
+
image:vcf_ora_vvol_datastore_01.png["Captura de pantalla que muestra la configuración del almacén de datos de vVols."]

+
image:vcf_ora_vvol_datastore_01_2.png["Captura de pantalla que muestra la configuración del almacén de datos de vVols."]

. Introducción de información general para el almacén de datos, incluido el destino de aprovisionamiento, el tipo, el nombre y el protocolo.
+
image:vcf_orarac_vvol_datastore_01.png["Captura de pantalla que muestra la configuración del almacén de datos de vVols."]

. Seleccione el perfil de capacidad de almacenamiento personalizado creado a partir del paso anterior, los `Storage system`y `Storage VM`, donde se van a crear los vVols.
+
image:vcf_orarac_vvol_datastore_02.png["Captura de pantalla que muestra la configuración del almacén de datos de vVols."]

. Seleccione `Create new volumes`, introduzca el nombre y el tamaño del volumen y haga clic en `ADD` y, a continuación, `NEXT` para ir a la página de resumen.
+
image:vcf_orarac_vvol_datastore_03.png["Captura de pantalla que muestra la configuración del almacén de datos de vVols."] image:vcf_orarac_vvol_datastore_04.png["Captura de pantalla que muestra la configuración del almacén de datos de vVols."]

. Haga clic `Finish` para crear el almacén de datos vVols para el binario de Oracle.
+
image:vcf_orarac_vvol_datastore_05.png["Captura de pantalla que muestra la configuración del almacén de datos de vVols."]

. Crear almacén de datos para el registro de cluster de Oracle o CRS.
+
image:vcf_orarac_vvol_datastore_06.png["Captura de pantalla que muestra la configuración del almacén de datos de vVols."]

+

NOTE: Podría añadir más de un volumen a un almacén de datos vVols o abarcar volúmenes de almacenes de datos vVols en los nodos de controladoras ONTAP para mejorar el rendimiento o la redundancia.

. Crear almacén de datos para datos de Oracle. Lo ideal es crear almacenes de datos independientes en cada nodo de controladora de ONTAP y emplear Oracle ASM para distribuir los datos entre los nodos de las controladoras para maximizar el uso de la capacidad del cluster de almacenamiento de ONTAP.
+
image:vcf_orarac_vvol_datastore_06_1.png["Captura de pantalla que muestra la configuración del almacén de datos de vVols."] image:vcf_orarac_vvol_datastore_06_2.png["Captura de pantalla que muestra la configuración del almacén de datos de vVols."]

. Crear almacén de datos para el registro de Oracle. Dada la naturaleza secuencial de la escritura de registros de Oracle, es bueno colocarla en un solo nodo de controladora de ONTAP.
+
image:vcf_orarac_vvol_datastore_06_3.png["Captura de pantalla que muestra la configuración del almacén de datos de vVols."]

. Valide los almacenes de datos de Oracle después de la implementación.
+
image:vcf_orarac_vvol_datastore_07.png["Captura de pantalla que muestra la configuración del almacén de datos de vVols."]



====


=== Crear una normativa de almacenamiento de VM basada en el perfil de funcionalidad de almacenamiento

[%collapsible]
====
Antes de aprovisionar el almacenamiento desde el almacén de datos vVols a la máquina virtual de base de datos, agregue una política de almacenamiento de máquina virtual basada en el perfil de funcionalidad de almacenamiento creado a partir del paso anterior. Los siguientes son los procedimientos.

. En los menús del cliente de vSphere, abra `Policies and Profiles` y resalte `VM Storage Policies`. Haga clic `Create` para abrir `VM Storage Policies` el flujo de trabajo.
+
image:vcf_ora_vvol_vm_policy_01.png["Captura de pantalla que muestra la configuración de una política de almacenamiento de la máquina virtual."]

. Asigne el nombre a la política de almacenamiento de las máquinas virtuales.
+
image:vcf_ora_vvol_vm_policy_02.png["Captura de pantalla que muestra la configuración de una política de almacenamiento de la máquina virtual."]

. En `Datastore specific rules`, comprobar `Enable rules for "NetAPP.clustered.Data.ONTAP.VP.vvol" storage`
+
image:vcf_ora_vvol_vm_policy_03.png["Captura de pantalla que muestra la configuración de una política de almacenamiento de la máquina virtual."]

. Para las reglas NetApp.clustered.Data.ONTAP.VP.vvol `Placement`, seleccione el perfil de capacidad de almacenamiento personalizado creado del paso anterior.
+
image:vcf_ora_vvol_vm_policy_04.png["Captura de pantalla que muestra la configuración de una política de almacenamiento de la máquina virtual."]

. Para las reglas de NetApp.clustered.Data.ONTAP.VP.vvol `Replication`, elija `Disabled` si no se replican los vVols.
+
image:vcf_ora_vvol_vm_policy_04_1.png["Captura de pantalla que muestra la configuración de una política de almacenamiento de la máquina virtual."]

. La página de compatibilidad del almacenamiento muestra los almacenes de datos de vVols compatibles en un entorno de VCF.
+
image:vcf_orarac_vvol_datastore_08.png["Captura de pantalla que muestra la configuración de una política de almacenamiento de la máquina virtual."]

. Revise y termine para crear la política de almacenamiento de VM.
+
image:vcf_ora_vvol_vm_policy_06.png["Captura de pantalla que muestra la configuración de una política de almacenamiento de la máquina virtual."]

. Valide la política de almacenamiento del equipo virtual que acaba de crearse.
+
image:vcf_ora_vvol_vm_policy_07.png["Captura de pantalla que muestra la configuración de una política de almacenamiento de la máquina virtual."]



====


=== Asignar discos a máquinas virtuales de RAC desde almacenes de datos de vVols y configurar el almacenamiento de base de datos

[%collapsible]
====
En el cliente de vSphere, añada los discos deseados desde los almacenes de datos vVols a la máquina virtual de base de datos editando la configuración de la máquina virtual. A continuación, inicie sesión en la máquina virtual para formatear y monte el disco binario en los puntos de montaje /u01. A continuación se muestran los pasos y tareas exactos.

. Antes de asignar discos desde el almacén de datos a la máquina virtual de base de datos, inicie sesión en hosts VMware ESXi para validar y asegurarse de que los escritores múltiples estén habilitados (valor de GBLAllowMW configurado en 1) a nivel ESXi.
+
....
[root@vcf-wkld-esx01:~] which esxcli
/bin/esxcli
[root@vcf-wkld-esx01:~] esxcli system settings advanced list -o /VMFS3/GBLAllowMW
   Path: /VMFS3/GBLAllowMW
   Type: integer
   Int Value: 1
   Default Int Value: 1
   Min Value: 0
   Max Value: 1
   String Value:
   Default String Value:
   Valid Characters:
   Description: Allow multi-writer GBLs.
   Host Specific: false
   Impact: none
[root@vcf-wkld-esx01:~]

....
. Agregue un nuevo controlador SCSI dedicado para usarlo con discos RAC de Oracle. Desactive el uso compartido de bus SCSI.
+
image:vcf_orarac_vvol_vm_01.png["Captura de pantalla que muestra una configuración de almacenamiento de máquina virtual."]

. Desde el nodo de RAC 1 - ora01, agregue un disco a la máquina virtual para el almacenamiento binario de Oracle sin compartirlo.
+
image:vcf_orarac_vvol_vm_02.png["Captura de pantalla que muestra una configuración de almacenamiento de máquina virtual."]

. Desde el nodo de RAC 1, agregue tres discos a VM para el almacenamiento de CRS de Oracle RAC y habilite el uso compartido de varios escritores.
+
image:vcf_orarac_vvol_vm_03.png["Captura de pantalla que muestra una configuración de almacenamiento de máquina virtual."] image:vcf_orarac_vvol_vm_04.png["Captura de pantalla que muestra una configuración de almacenamiento de máquina virtual."] image:vcf_orarac_vvol_vm_05.png["Captura de pantalla que muestra una configuración de almacenamiento de máquina virtual."]

. Desde el nodo de RAC 1, agregue dos discos cada uno de cada almacén de datos para transferir datos a una máquina virtual para el almacenamiento compartido de datos de Oracle.
+
image:vcf_orarac_vvol_vm_06.png["Captura de pantalla que muestra una configuración de almacenamiento de máquina virtual."] image:vcf_orarac_vvol_vm_08.png["Captura de pantalla que muestra una configuración de almacenamiento de máquina virtual."] image:vcf_orarac_vvol_vm_09.png["Captura de pantalla que muestra una configuración de almacenamiento de máquina virtual."] image:vcf_orarac_vvol_vm_10.png["Captura de pantalla que muestra una configuración de almacenamiento de máquina virtual."]

. Desde el nodo de RAC 1, agregue dos discos a la máquina virtual desde el almacén de datos logs para el almacenamiento compartido de archivos log de Oracle.
+
image:vcf_orarac_vvol_vm_11.png["Captura de pantalla que muestra una configuración de almacenamiento de máquina virtual."] image:vcf_orarac_vvol_vm_12.png["Captura de pantalla que muestra una configuración de almacenamiento de máquina virtual."]

. Desde el nodo de RAC 2, agregue un disco a la máquina virtual para el almacenamiento binario de Oracle sin compartirlo.
+
image:vcf_orarac_vvol_vm_13.png["Captura de pantalla que muestra una configuración de almacenamiento de máquina virtual."]

. Desde el nodo RAC 2, agregue otros discos compartidos seleccionando `Existing Hard Disks` la opción y active el uso compartido de varios escritores para cada disco compartido.
+
image:vcf_orarac_vvol_vm_14.png["Captura de pantalla que muestra una configuración de almacenamiento de máquina virtual."] image:vcf_orarac_vvol_vm_15.png["Captura de pantalla que muestra una configuración de almacenamiento de máquina virtual."]

. De VM `Edit Settings`, , `Advanced Parameters`agregar atributo `disk.enableuuid` con valor `TRUE`. La VM debe estar inactiva para agregar el parámetro avanzado. Al configurar esta opción, SnapCenter podrá identificar con precisión el VVOL en su entorno. Esto se debe realizar en todos los nodos de RAC.
+
image:vcf_ora_vvol_vm_uuid.png["Captura de pantalla que muestra una configuración de almacenamiento de máquina virtual."]

. Ahora, reinicie la máquina virtual. Inicie sesión en un equipo virtual como usuario administrador a través de ssh para revisar las unidades de disco que se acaban de añadir.
+
....
[admin@ora01 ~]$ sudo lsblk
NAME          MAJ:MIN RM  SIZE RO TYPE MOUNTPOINT
sda             8:0    0   50G  0 disk
├─sda1          8:1    0  600M  0 part /boot/efi
├─sda2          8:2    0    1G  0 part /boot
└─sda3          8:3    0 48.4G  0 part
  ├─rhel-root 253:0    0 43.4G  0 lvm  /
  └─rhel-swap 253:1    0    5G  0 lvm  [SWAP]
sdb             8:16   0   50G  0 disk
sdc             8:32   0   10G  0 disk
sdd             8:48   0   10G  0 disk
sde             8:64   0   10G  0 disk
sdf             8:80   0   40G  0 disk
sdg             8:96   0   40G  0 disk
sdh             8:112  0   40G  0 disk
sdi             8:128  0   40G  0 disk
sdj             8:144  0   80G  0 disk
sdk             8:160  0   80G  0 disk
sr0            11:0    1 1024M  0 rom
[admin@ora01 ~]$

[admin@ora02 ~]$ sudo lsblk
NAME          MAJ:MIN RM  SIZE RO TYPE MOUNTPOINT
sda             8:0    0   50G  0 disk
├─sda1          8:1    0  600M  0 part /boot/efi
├─sda2          8:2    0    1G  0 part /boot
└─sda3          8:3    0 48.4G  0 part
  ├─rhel-root 253:0    0 43.4G  0 lvm  /
  └─rhel-swap 253:1    0    5G  0 lvm  [SWAP]
sdb             8:16   0   50G  0 disk
sdc             8:32   0   10G  0 disk
sdd             8:48   0   10G  0 disk
sde             8:64   0   10G  0 disk
sdf             8:80   0   40G  0 disk
sdg             8:96   0   40G  0 disk
sdh             8:112  0   40G  0 disk
sdi             8:128  0   40G  0 disk
sdj             8:144  0   80G  0 disk
sdk             8:160  0   80G  0 disk
sr0            11:0    1 1024M  0 rom
[admin@ora02 ~]$


....
. Desde cada nodo RAC, cree particiones en el disco binario de Oracle (/dev/sdb) como partición primaria y única simplemente aceptando las opciones por defecto.
+
[source, cli]
----
sudo fdisk /dev/sdb
----
. Formatee los discos particionados como sistemas de archivos xfs.
+
[source, cli]
----
sudo mkfs.xfs /dev/sdb1
----
. Monte el disco en el punto de montaje /u01.
+
....
[admin@ora01 ~]$ df -h
Filesystem             Size  Used Avail Use% Mounted on
devtmpfs               7.7G   36K  7.7G   1% /dev
tmpfs                  7.8G  1.4G  6.4G  18% /dev/shm
tmpfs                  7.8G   34M  7.7G   1% /run
tmpfs                  7.8G     0  7.8G   0% /sys/fs/cgroup
/dev/mapper/rhel-root   44G   29G   16G  66% /
/dev/sda2             1014M  249M  766M  25% /boot
/dev/sda1              599M  5.9M  593M   1% /boot/efi
/dev/sdb1               50G   24G   27G  47% /u01
tmpfs                  1.6G   12K  1.6G   1% /run/user/42
tmpfs                  1.6G     0  1.6G   0% /run/user/54331
tmpfs                  1.6G  4.0K  1.6G   1% /run/user/1000


....
. Añada puntos de montaje a /etc/fstab para que las unidades de disco se monten cuando se reinicie la máquina virtual.
+
[source, cli]
----
sudo vi /etc/fstab
----
+
....
[oracle@ora_01 ~]$ cat /etc/fstab

#
# /etc/fstab
# Created by anaconda on Wed Oct 18 19:43:31 2023
#
# Accessible filesystems, by reference, are maintained under '/dev/disk/'.
# See man pages fstab(5), findfs(8), mount(8) and/or blkid(8) for more info.
#
# After editing this file, run 'systemctl daemon-reload' to update systemd
# units generated from this file.
#
/dev/mapper/rhel-root   /                       xfs     defaults        0 0
UUID=aff942c4-b224-4b62-807d-6a5c22f7b623 /boot                   xfs     defaults        0 0
/dev/mapper/rhel-swap   none                    swap    defaults        0 0
/root/swapfile swap swap defaults 0 0
/dev/sdb1               /u01                    xfs     defaults        0 0
....


====


=== Despliegue de Oracle RAC en VCF

[%collapsible]
====
Se recomienda aprovechar el kit de herramientas de automatización de NetApp para poner en marcha Oracle RAC en VCF con vVols. Lea atentamente la instrucción incluida (readme) y configure los archivos de parámetros de despliegue como archivo de destino de despliegue - hosts, archivo de variables globales - vars/vars.yml y archivo de variables de VM de base de datos local - host_vars/host_name.yml siguiendo las instrucciones del kit de herramientas. A continuación se muestran los procedimientos paso a paso.

. Inicie sesión en la máquina virtual de controladora de Ansible como usuario administrador a través de SSH y clone una copia del kit de herramientas de automatización para la puesta en marcha de Oracle RAC en VCF con vVols.
+
[source, cli]
----
git clone https://bitbucket.ngage.netapp.com/scm/ns-bb/na_oracle_deploy_rac.git
----
. Almacenar en zona intermedia los siguientes archivos de instalación de Oracle en la carpeta /tmp/archive en la máquina virtual de base de datos del nodo RAC 1. La carpeta debe permitir el acceso de todos los usuarios con el permiso 777.
+
....
LINUX.X64_193000_grid_home.zip
p34762026_190000_Linux-x86-64.zip
LINUX.X64_193000_db_home.zip
p34765931_190000_Linux-x86-64.zip
p6880880_190000_Linux-x86-64.zip
....
. Configurar la autenticación sin clave ssh entre la controladora de Ansible y las máquinas virtuales de base de datos, lo que requiere generar un par de claves ssh y copiar la clave pública en el directorio raíz del usuario administrador de las máquinas virtuales de base de datos .ssh carpeta archivo authorized_keys.
+
[source, cli]
----
ssh-keygen
----
. Configure los archivos de parámetros de host de destino definidos por el usuario. A continuación se muestra un ejemplo de configuración típica para el archivo de hosts de destino: Hosts.
+
....
#Oracle hosts
[oracle]
ora01 ansible_host=10.61.180.21 ansible_ssh_private_key_file=ora01.pem
ora02 ansible_host=10.61.180.22 ansible_ssh_private_key_file=ora02.pem

....
. Configure los archivos de parámetros específicos del host local definidos por el usuario. A continuación se muestra un ejemplo de configuración típica del archivo host_name.yml local - ora01.yml.
+
....

# Binary lun
ora_bin: /dev/sdb

# Host DB configuration
ins_sid: "{{ oracle_sid }}1"
asm_sid: +ASM1

....
. Configure el archivo de parámetros globales definido por el usuario. A continuación se muestra un ejemplo de configuración típica para el archivo de parámetros globales: vars.yml
+
....

#######################################################################
### ONTAP env specific config variables                             ###
#######################################################################

# ONTAP storage platform: on-prem, vmware-vvols
ontap_platform: vmware-vvols

# Prerequisite to create five vVolss in VMware vCenter
# VCF_ORA_BINS - Oracle binary
# VCF_ORA_CRS  - Oracle cluster registry and vote
# VCF_ORA_DAT1 - Oracle data on node1
# VCF_ORA_DAT2 - Oracle data on node2
# VCF_ORA_LOGS - Oracle logs on node1 or node2

# Oracle disks are added to VM from vVols: 1 binary disk, 3 CRS disks, 4 data disks, and 2 log disks.


######################################################################
### Linux env specific config variables                            ###
######################################################################

redhat_sub_username: XXXXXXXX
redhat_sub_password: "XXXXXXXX"

# Networking configuration
cluster_pub_ip:
  - {ip: 10.61.180.21, hostname: ora01}
  - {ip: 10.61.180.22, hostname: ora02}

cluster_pri_ip:
  - {ip: 172.21.166.22, hostname: ora01-pri}
  - {ip: 172.21.166.24, hostname: ora02-pri}

cluster_vip_ip:
  - {ip: 10.61.180.93, hostname: ora01-vip}
  - {ip: 10.61.180.94, hostname: ora02-vip}

cluster_scan_name: ntap-scan
cluster_scan_ip:
  - {ip: 10.61.180.90, hostname: ntap-scan}
  - {ip: 10.61.180.91, hostname: ntap-scan}
  - {ip: 10.61.180.92, hostname: ntap-scan}


#####################################################################
### DB env specific install and config variables                  ###
#####################################################################

# Shared Oracle RAC storage
ora_crs:
  - { device: /dev/sdc, name: ora_crs_01 }
  - { device: /dev/sdd, name: ora_crs_02 }
  - { device: /dev/sde, name: ora_crs_03 }

ora_data:
  - { device: /dev/sdf, name: ora_data_01 }
  - { device: /dev/sdg, name: ora_data_02 }
  - { device: /dev/sdh, name: ora_data_03 }
  - { device: /dev/sdi, name: ora_data_04 }

ora_logs:
  - { device: /dev/sdj, name: ora_logs_01 }
  - { device: /dev/sdk, name: ora_logs_02 }

# Oracle RAC configuration

oracle_sid: NTAP
cluster_name: ntap-rac
cluster_nodes: ora01,ora02
cluster_domain: solutions.netapp.com
grid_cluster_nodes: ora01:ora01-vip:HUB,ora02:ora02-vip:HUB
network_interface_list: ens33:10.61.180.0:1,ens34:172.21.166.0:5
memory_limit: 10240

# Set initial password for all required Oracle passwords. Change them after installation.
initial_pwd_all: "XXXXXXXX"

....
. Desde la controladora Ansible, directorio inicial del kit de herramientas de automatización clonado /home/admin/na_oracle_deploy_rac, ejecute la libro de estrategia de requisitos previos para configurar los requisitos de Ansible.
+
[source, cli]
----
ansible-playbook -i hosts 1-ansible_requirements.yml
----
. Ejecute la guía de configuración de Linux.
+
[source, cli]
----
ansible-playbook -i hosts 2-linux_config.yml -u admin -e @vars/vars.yml
----
. Ejecute el libro de estrategia de despliegue de Oracle.
+
[source, cli]
----
ansible-playbook -i hosts 4-oracle_config.yml -u admin -e @vars/vars.yml
----
. Si lo desea, también se pueden ejecutar todos los libros de estrategia anteriores desde una única ejecución de un libro de estrategia.
+
[source, cli]
----
ansible-playbook -i hosts 0-all_playbook.yml -u admin -e @vars/vars.yml
----


====


=== Validación de despliegue de Oracle RAC en VCF

[%collapsible]
====
Esta sección proporciona detalles sobre la validación del despliegue de Oracle RAC en VCF para garantizar que todos los recursos de Oracle RAC están completamente desplegados, configurados y funcionando como se esperaba.

. Conéctese a RAC VM como usuario administrador para validar la infraestructura de grid de Oracle.
+
....
[admin@ora01 ~]$ sudo su
[root@ora01 admin]# su - grid
[grid@ora01 ~]$ crsctl stat res -t
--------------------------------------------------------------------------------
Name           Target  State        Server                   State details
--------------------------------------------------------------------------------
Local Resources
--------------------------------------------------------------------------------
ora.LISTENER.lsnr
               ONLINE  ONLINE       ora01                    STABLE
               ONLINE  ONLINE       ora02                    STABLE
ora.chad
               ONLINE  ONLINE       ora01                    STABLE
               ONLINE  ONLINE       ora02                    STABLE
ora.net1.network
               ONLINE  ONLINE       ora01                    STABLE
               ONLINE  ONLINE       ora02                    STABLE
ora.ons
               ONLINE  ONLINE       ora01                    STABLE
               ONLINE  ONLINE       ora02                    STABLE
ora.proxy_advm
               OFFLINE OFFLINE      ora01                    STABLE
               OFFLINE OFFLINE      ora02                    STABLE
--------------------------------------------------------------------------------
Cluster Resources
--------------------------------------------------------------------------------
ora.ASMNET1LSNR_ASM.lsnr(ora.asmgroup)
      1        ONLINE  ONLINE       ora01                    STABLE
      2        ONLINE  ONLINE       ora02                    STABLE
ora.DATA.dg(ora.asmgroup)
      1        ONLINE  ONLINE       ora01                    STABLE
      2        ONLINE  ONLINE       ora02                    STABLE
ora.LISTENER_SCAN1.lsnr
      1        ONLINE  ONLINE       ora01                    STABLE
ora.LISTENER_SCAN2.lsnr
      1        ONLINE  ONLINE       ora02                    STABLE
ora.LISTENER_SCAN3.lsnr
      1        ONLINE  ONLINE       ora02                    STABLE
ora.RECO.dg(ora.asmgroup)
      1        ONLINE  ONLINE       ora01                    STABLE
      2        ONLINE  ONLINE       ora02                    STABLE
ora.VOTE.dg(ora.asmgroup)
      1        ONLINE  ONLINE       ora01                    STABLE
      2        ONLINE  ONLINE       ora02                    STABLE
ora.asm(ora.asmgroup)
      1        ONLINE  ONLINE       ora01                    Started,STABLE
      2        ONLINE  ONLINE       ora02                    Started,STABLE
ora.asmnet1.asmnetwork(ora.asmgroup)
      1        ONLINE  ONLINE       ora01                    STABLE
      2        ONLINE  ONLINE       ora02                    STABLE
ora.cvu
      1        ONLINE  ONLINE       ora02                    STABLE
ora.ntap.db
      1        ONLINE  ONLINE       ora01                    Open,HOME=/u01/app/o
                                                             racle2/product/19.0.
                                                             0/NTAP,STABLE
      2        ONLINE  ONLINE       ora02                    Open,HOME=/u01/app/o
                                                             racle2/product/19.0.
                                                             0/NTAP,STABLE
ora.ora01.vip
      1        ONLINE  ONLINE       ora01                    STABLE
ora.ora02.vip
      1        ONLINE  ONLINE       ora02                    STABLE
ora.qosmserver
      1        ONLINE  ONLINE       ora02                    STABLE
ora.scan1.vip
      1        ONLINE  ONLINE       ora01                    STABLE
ora.scan2.vip
      1        ONLINE  ONLINE       ora02                    STABLE
ora.scan3.vip
      1        ONLINE  ONLINE       ora02                    STABLE
--------------------------------------------------------------------------------
[grid@ora01 ~]$

....
. Validar Oracle ASM.
+
....
[grid@ora01 ~]$ asmcmd
ASMCMD> lsdg
State    Type    Rebal  Sector  Logical_Sector  Block       AU  Total_MB  Free_MB  Req_mir_free_MB  Usable_file_MB  Offline_disks  Voting_files  Name
MOUNTED  EXTERN  N         512             512   4096  1048576    163840   163723                0          163723              0             N  DATA/
MOUNTED  EXTERN  N         512             512   4096  1048576    163840   163729                0          163729              0             N  RECO/
MOUNTED  NORMAL  N         512             512   4096  4194304     30720    29732            10240            9746              0             Y  VOTE/
ASMCMD> lsdsk
Path
AFD:ORA_CRS_01
AFD:ORA_CRS_02
AFD:ORA_CRS_03
AFD:ORA_DATA_01
AFD:ORA_DATA_02
AFD:ORA_DATA_03
AFD:ORA_DATA_04
AFD:ORA_LOGS_01
AFD:ORA_LOGS_02
ASMCMD> afd_state
ASMCMD-9526: The AFD state is 'LOADED' and filtering is 'ENABLED' on host 'ora01'
ASMCMD>

....
. Muestra los nodos del clúster.
+
....

[grid@ora01 ~]$ olsnodes
ora01
ora02

....
. Validar OCR/VOTO.
+
....
[grid@ora01 ~]$ ocrcheck
Status of Oracle Cluster Registry is as follows :
         Version                  :          4
         Total space (kbytes)     :     901284
         Used space (kbytes)      :      84536
         Available space (kbytes) :     816748
         ID                       :  118267044
         Device/File Name         :      +VOTE
                                    Device/File integrity check succeeded

                                    Device/File not configured

                                    Device/File not configured

                                    Device/File not configured

                                    Device/File not configured

         Cluster registry integrity check succeeded

         Logical corruption check bypassed due to non-privileged user

[grid@ora01 ~]$ crsctl query css votedisk
##  STATE    File Universal Id                File Name Disk group
--  -----    -----------------                --------- ---------
 1. ONLINE   1ca3fcb0bd354f8ebf00ac97d70e0824 (AFD:ORA_CRS_01) [VOTE]
 2. ONLINE   708f84d505a54f58bf41124e09a5115a (AFD:ORA_CRS_02) [VOTE]
 3. ONLINE   133ecfcedb684fe6bfdc1899b90f91c7 (AFD:ORA_CRS_03) [VOTE]
Located 3 voting disk(s).
[grid@ora01 ~]$


....
. Validar listener de Oracle.
+
....
[grid@ora01 ~]$ lsnrctl status listener

LSNRCTL for Linux: Version 19.0.0.0.0 - Production on 16-AUG-2024 10:21:38

Copyright (c) 1991, 2022, Oracle.  All rights reserved.

Connecting to (DESCRIPTION=(ADDRESS=(PROTOCOL=IPC)(KEY=LISTENER)))
STATUS of the LISTENER
------------------------
Alias                     LISTENER
Version                   TNSLSNR for Linux: Version 19.0.0.0.0 - Production
Start Date                14-AUG-2024 16:24:48
Uptime                    1 days 17 hr. 56 min. 49 sec
Trace Level               off
Security                  ON: Local OS Authentication
SNMP                      OFF
Listener Parameter File   /u01/app/grid/19.0.0/network/admin/listener.ora
Listener Log File         /u01/app/oracle/diag/tnslsnr/ora01/listener/alert/log.xml
Listening Endpoints Summary...
  (DESCRIPTION=(ADDRESS=(PROTOCOL=ipc)(KEY=LISTENER)))
  (DESCRIPTION=(ADDRESS=(PROTOCOL=tcp)(HOST=10.61.180.21)(PORT=1521)))
  (DESCRIPTION=(ADDRESS=(PROTOCOL=tcp)(HOST=10.61.180.93)(PORT=1521)))
  (DESCRIPTION=(ADDRESS=(PROTOCOL=tcps)(HOST=ora01.solutions.netapp.com)(PORT=5500))(Security=(my_wallet_directory=/u01/app/oracle2/product/19.0.0/NTAP/admin/NTAP/xdb_wallet))(Presentation=HTTP)(Session=RAW))
Services Summary...
Service "+ASM" has 1 instance(s).
  Instance "+ASM1", status READY, has 1 handler(s) for this service...
Service "+ASM_DATA" has 1 instance(s).
  Instance "+ASM1", status READY, has 1 handler(s) for this service...
Service "+ASM_RECO" has 1 instance(s).
  Instance "+ASM1", status READY, has 1 handler(s) for this service...
Service "+ASM_VOTE" has 1 instance(s).
  Instance "+ASM1", status READY, has 1 handler(s) for this service...
Service "1fbf0aaa1d13cb5ae06315b43d0ab734.solutions.netapp.com" has 1 instance(s).
  Instance "NTAP1", status READY, has 1 handler(s) for this service...
Service "1fbf142e7db2d090e06315b43d0a6894.solutions.netapp.com" has 1 instance(s).
  Instance "NTAP1", status READY, has 1 handler(s) for this service...
Service "1fbf203c3a46d7bae06315b43d0ae055.solutions.netapp.com" has 1 instance(s).
  Instance "NTAP1", status READY, has 1 handler(s) for this service...
Service "NTAP.solutions.netapp.com" has 1 instance(s).
  Instance "NTAP1", status READY, has 1 handler(s) for this service...
Service "NTAPXDB.solutions.netapp.com" has 1 instance(s).
  Instance "NTAP1", status READY, has 1 handler(s) for this service...
Service "ntap_pdb1.solutions.netapp.com" has 1 instance(s).
  Instance "NTAP1", status READY, has 1 handler(s) for this service...
Service "ntap_pdb2.solutions.netapp.com" has 1 instance(s).
  Instance "NTAP1", status READY, has 1 handler(s) for this service...
Service "ntap_pdb3.solutions.netapp.com" has 1 instance(s).
  Instance "NTAP1", status READY, has 1 handler(s) for this service...
The command completed successfully
[grid@ora01 ~]$

[grid@ora01 ~]$ tnsping ntap-scan

TNS Ping Utility for Linux: Version 19.0.0.0.0 - Production on 16-AUG-2024 12:07:58

Copyright (c) 1997, 2022, Oracle.  All rights reserved.

Used parameter files:
/u01/app/grid/19.0.0/network/admin/sqlnet.ora

Used EZCONNECT adapter to resolve the alias
Attempting to contact (DESCRIPTION=(CONNECT_DATA=(SERVICE_NAME=))(ADDRESS=(PROTOCOL=tcp)(HOST=10.61.180.90)(PORT=1521))(ADDRESS=(PROTOCOL=tcp)(HOST=10.61.180.91)(PORT=1521))(ADDRESS=(PROTOCOL=tcp)(HOST=10.61.180.92)(PORT=1521)))
OK (10 msec)


....
. Cambie al usuario oracle para validar la base de datos en cluster.
+
....
[oracle@ora02 ~]$ sqlplus / as sysdba

SQL*Plus: Release 19.0.0.0.0 - Production on Fri Aug 16 11:32:23 2024
Version 19.18.0.0.0

Copyright (c) 1982, 2022, Oracle.  All rights reserved.


Connected to:
Oracle Database 19c Enterprise Edition Release 19.0.0.0.0 - Production
Version 19.18.0.0.0

SQL> select name, open_mode, log_mode from v$database;

NAME      OPEN_MODE            LOG_MODE
--------- -------------------- ------------
NTAP      READ WRITE           ARCHIVELOG

SQL> show pdbs

    CON_ID CON_NAME                       OPEN MODE  RESTRICTED
---------- ------------------------------ ---------- ----------
         2 PDB$SEED                       READ ONLY  NO
         3 NTAP_PDB1                      READ WRITE NO
         4 NTAP_PDB2                      READ WRITE NO
         5 NTAP_PDB3                      READ WRITE NO
SQL> select name from v$datafile
  2  union
  3  select name from v$controlfile
  4  union
  5  select member from v$logfile;

NAME
--------------------------------------------------------------------------------
+DATA/NTAP/1FBF0AAA1D13CB5AE06315B43D0AB734/DATAFILE/sysaux.275.1177083797
+DATA/NTAP/1FBF0AAA1D13CB5AE06315B43D0AB734/DATAFILE/system.274.1177083797
+DATA/NTAP/1FBF0AAA1D13CB5AE06315B43D0AB734/DATAFILE/undo_2.277.1177083853
+DATA/NTAP/1FBF0AAA1D13CB5AE06315B43D0AB734/DATAFILE/undotbs1.273.1177083797
+DATA/NTAP/1FBF0AAA1D13CB5AE06315B43D0AB734/DATAFILE/users.278.1177083901
+DATA/NTAP/1FBF142E7DB2D090E06315B43D0A6894/DATAFILE/sysaux.281.1177083903
+DATA/NTAP/1FBF142E7DB2D090E06315B43D0A6894/DATAFILE/system.280.1177083903
+DATA/NTAP/1FBF142E7DB2D090E06315B43D0A6894/DATAFILE/undo_2.283.1177084061
+DATA/NTAP/1FBF142E7DB2D090E06315B43D0A6894/DATAFILE/undotbs1.279.1177083903
+DATA/NTAP/1FBF142E7DB2D090E06315B43D0A6894/DATAFILE/users.284.1177084103
+DATA/NTAP/1FBF203C3A46D7BAE06315B43D0AE055/DATAFILE/sysaux.287.1177084105

NAME
--------------------------------------------------------------------------------
+DATA/NTAP/1FBF203C3A46D7BAE06315B43D0AE055/DATAFILE/system.286.1177084105
+DATA/NTAP/1FBF203C3A46D7BAE06315B43D0AE055/DATAFILE/undo_2.289.1177084123
+DATA/NTAP/1FBF203C3A46D7BAE06315B43D0AE055/DATAFILE/undotbs1.285.1177084105
+DATA/NTAP/1FBF203C3A46D7BAE06315B43D0AE055/DATAFILE/users.290.1177084125
+DATA/NTAP/86B637B62FE07A65E053F706E80A27CA/DATAFILE/sysaux.266.1177081837
+DATA/NTAP/86B637B62FE07A65E053F706E80A27CA/DATAFILE/system.265.1177081837
+DATA/NTAP/86B637B62FE07A65E053F706E80A27CA/DATAFILE/undotbs1.267.1177081837
+DATA/NTAP/CONTROLFILE/current.261.1177080403
+DATA/NTAP/DATAFILE/sysaux.258.1177080245
+DATA/NTAP/DATAFILE/system.257.1177080129
+DATA/NTAP/DATAFILE/undotbs1.259.1177080311

NAME
--------------------------------------------------------------------------------
+DATA/NTAP/DATAFILE/undotbs2.269.1177082203
+DATA/NTAP/DATAFILE/users.260.1177080311
+DATA/NTAP/ONLINELOG/group_1.262.1177080427
+DATA/NTAP/ONLINELOG/group_2.263.1177080427
+DATA/NTAP/ONLINELOG/group_3.270.1177083297
+DATA/NTAP/ONLINELOG/group_4.271.1177083313
+RECO/NTAP/CONTROLFILE/current.256.1177080403
+RECO/NTAP/ONLINELOG/group_1.257.1177080427
+RECO/NTAP/ONLINELOG/group_2.258.1177080427
+RECO/NTAP/ONLINELOG/group_3.259.1177083313
+RECO/NTAP/ONLINELOG/group_4.260.1177083315

33 rows selected.


....
. También puede iniciar sesión en EM Express para validar la base de datos RAC después de la ejecución correcta de playbook.
+
image:vcf_orarac_vvol_em_01.png["Captura de pantalla que muestra la configuración de Oracle EM Express."] image:vcf_orarac_vvol_em_02.png["Captura de pantalla que muestra la configuración de Oracle EM Express."]



====


=== Backup y recuperación de bases de datos de Oracle RAC en VCF con SnapCenter



==== Configuración de SnapCenter

[%collapsible]
====
La versión 6 de SnapCenter cuenta con numerosas mejoras de funciones respecto a la versión 5, incluida la compatibilidad con almacenes de datos VMware vVols. SnapCenter se basa en un complemento en el lado del host en una máquina virtual de base de datos para realizar actividades de gestión de protección de datos para aplicaciones. Para obtener información detallada sobre el plugin de NetApp SnapCenter para Oracle, consulte esta documentación link:https://docs.netapp.com/us-en/snapcenter/protect-sco/concept_what_you_can_do_with_the_snapcenter_plug_in_for_oracle_database.html["Qué puede hacer con el plugin para base de datos de Oracle"^]. A continuación se proporcionan pasos de alto nivel para configurar la copia de seguridad y la recuperación de datos de SnapCenter versión 6 para la base de datos de Oracle RAC en VCF.

. Descargue la versión 6 del software de SnapCenter desde el sitio de soporte de NetApp: link:https://mysupport.netapp.com/site/downloads["Descargas de soporte de NetApp"^].
. Inicie sesión en el SnapCenter que aloja Windows VM como administrador. Requisitos previos de instalación para SnapCenter 6,0.
+
image:vcf_ora_vvol_snapctr_prerequisites.png["Captura de pantalla que muestra los requisitos previos de SnapCenter 6,0."]

. Como administrador, instale el último JDK de java desde link:https://www.java.com/en/["Obtenga Java para aplicaciones de escritorio"^].
+

NOTE: Si el servidor Windows se implementa en un entorno de dominio, añada un usuario de dominio al grupo de administradores locales del servidor SnapCenter y ejecute la instalación de SnapCenter con el usuario del dominio.

. Inicie sesión en la interfaz de usuario de SnapCenter a través del puerto HTTPS 8846 como usuario de instalación para configurar SnapCenter para Oracle.
+
image:vcf_ora_vvol_snapctr_deploy_01.png["Captura de pantalla que muestra la configuración de SnapCenter."]

. Menú Revisar `Get Started` para ponerse al día en SnapCenter si usted es un nuevo usuario.
+
image:vcf_ora_vvol_snapctr_deploy_02.png["Captura de pantalla que muestra la configuración de SnapCenter."]

. Actualizar `Hypervisor Settings` en ajustes globales.
+
image:aws_ora_fsx_vmc_snapctr_01.png["Captura de pantalla que muestra la configuración de SnapCenter."]

. Añada el clúster de almacenamiento de ONTAP a `Storage Systems` mediante la IP de administración del clúster y autenticado a través de ID de usuario administrador del clúster.
+
image:vcf_ora_vvol_snapctr_deploy_06.png["Captura de pantalla que muestra la configuración de SnapCenter."] image:vcf_ora_vvol_snapctr_deploy_07.png["Captura de pantalla que muestra la configuración de SnapCenter."]

. Añadir máquinas virtuales de base de datos de Oracle RAC y máquina virtual del complemento `Credential` de vSphere para el acceso de SnapCenter a máquina virtual de base de datos y máquina virtual del complemento de vSphere. La credencial debe tener el privilegio sudo en las máquinas virtuales de Linux. Puede crear credenciales diferentes para diferentes ID de usuario de gestión para las máquinas virtuales. El ID de usuario de gestión de máquinas virtuales del complemento vShpere se define cuando se implementa la máquina virtual del complemento en vCenter.
+
image:aws_ora_fsx_vmc_snapctr_03.png["Captura de pantalla que muestra la configuración de SnapCenter."]

. Agregue la VM de la base de datos Oracle RAC en VCF a `Hosts` con la credencial de VM de la base de datos creada en el paso anterior.
+
image:vcf_orarac_vvol_snapctr_setup_01.png["Captura de pantalla que muestra la configuración de SnapCenter."] image:vcf_orarac_vvol_snapctr_setup_02.png["Captura de pantalla que muestra la configuración de SnapCenter."] image:vcf_orarac_vvol_snapctr_setup_03.png["Captura de pantalla que muestra la configuración de SnapCenter."]

. Del mismo modo, agregue VM del complemento de VMware de NetApp a `Hosts` con la credencial de VM del complemento de vSphere creada en el paso anterior.
+
image:vcf_ora_vvol_snapctr_deploy_11.png["Captura de pantalla que muestra la configuración de SnapCenter."] image:vcf_orarac_vvol_snapctr_setup_04.png["Captura de pantalla que muestra la configuración de SnapCenter."]

. Finalmente, después de detectar la base de datos de Oracle en la máquina virtual de base de datos, vuelva a `Settings`-`Policies` crear políticas de backup de bases de datos de Oracle. Lo ideal es crear una normativa de backup de registros de archivo independiente que permita un intervalo de backup más frecuente para minimizar la pérdida de datos en caso de fallo.
+
image:aws_ora_fsx_vmc_snapctr_02.png["Captura de pantalla que muestra la configuración de SnapCenter."]




NOTE: Asegúrese de que el nombre del servidor SnapCenter se pueda resolver a la dirección IP de la máquina virtual de base de datos y de la máquina virtual del complemento vSphere. Del mismo modo, el nombre de la máquina virtual de la base de datos y el nombre de la máquina virtual del complemento de vSphere se pueden resolver a la dirección IP del servidor SnapCenter.

====


==== Backup de bases de datos

[%collapsible]
====
SnapCenter aprovecha la tecnología Snapshot de volumen de ONTAP para obtener backups, restauraciones o clones de bases de datos mucho más rápidos que la metodología tradicional basada en RMAN. Las copias Snapshot son coherentes con las aplicaciones, ya que se pone en modo de backup de Oracle antes de realizar una copia de Snapshot.

. Desde la `Resources` Pestaña, las bases de datos de la máquina virtual se detectan automáticamente después de que la máquina virtual se agrega a SnapCenter. Inicialmente, el estado de la base de datos se muestra como `Not protected`.
+
image:vcf_orarac_vvol_snapctr_bkup_01.png["Captura de pantalla que muestra la configuración de SnapCenter."]

. Haga clic en la base de datos para iniciar un flujo de trabajo y habilitar la protección de la base de datos.
+
image:vcf_orarac_vvol_snapctr_bkup_02.png["Captura de pantalla que muestra la configuración de SnapCenter."]

. Aplique la política de backup y configure la programación si es necesario.
+
image:vcf_orarac_vvol_snapctr_bkup_03.png["Captura de pantalla que muestra la configuración de SnapCenter."]

. Configurar notificación de trabajo de copia de seguridad si es necesario.
+
image:vcf_orarac_vvol_snapctr_bkup_05.png["Captura de pantalla que muestra la configuración de SnapCenter."]

. Revise el resumen y termine para habilitar la protección de bases de datos.
+
image:vcf_orarac_vvol_snapctr_bkup_06.png["Captura de pantalla que muestra la configuración de SnapCenter."]

. El trabajo de copia de seguridad bajo demanda se puede activar haciendo clic en `Back up Now`.
+
image:vcf_orarac_vvol_snapctr_bkup_07.png["Captura de pantalla que muestra la configuración de SnapCenter."] image:vcf_orarac_vvol_snapctr_bkup_08.png["Captura de pantalla que muestra la configuración de SnapCenter."]

. El trabajo de copia de seguridad se puede supervisar en el `Monitor` haciendo clic en el trabajo en ejecución.
+
image:vcf_orarac_vvol_snapctr_bkup_09.png["Captura de pantalla que muestra la configuración de SnapCenter."]

. Haga clic en DATABASE para revisar los conjuntos de backup completos para la base de datos RAC.
+
image:vcf_ora_vvol_snapctr_bkup_10.png["Captura de pantalla que muestra la configuración de SnapCenter."]



====


==== Restauración/recuperación de bases de datos

[%collapsible]
====
SnapCenter ofrece diversas opciones de restauración y recuperación para la base de datos de Oracle RAC a partir de un backup de snapshot. En este ejemplo, mostramos que restaura desde un backup Snapshot antiguo y, a continuación, se reenvía la base de datos al último registro disponible.

. En primer lugar, ejecute un backup de snapshot. A continuación, cree una tabla de prueba e inserte una fila en la tabla para validar la base de datos recuperada de la imagen de instantánea antes de que la creación de la tabla de prueba recupere la tabla de prueba.
+
....
[oracle@ora01 ~]$ sqlplus / as sysdba

SQL*Plus: Release 19.0.0.0.0 - Production on Mon Aug 19 10:31:12 2024
Version 19.18.0.0.0

Copyright (c) 1982, 2022, Oracle.  All rights reserved.


Connected to:
Oracle Database 19c Enterprise Edition Release 19.0.0.0.0 - Production
Version 19.18.0.0.0

SQL> show pdbs

    CON_ID CON_NAME                       OPEN MODE  RESTRICTED
---------- ------------------------------ ---------- ----------
         2 PDB$SEED                       READ ONLY  NO
         3 NTAP_PDB1                      READ WRITE NO
         4 NTAP_PDB2                      READ WRITE NO
         5 NTAP_PDB3                      READ WRITE NO
SQL> alter session set container=ntap_pdb1;

Session altered.


SQL> create table test (id integer, dt timestamp, event varchar(100));

Table created.

SQL> insert into test values (1, sysdate, 'validate SnapCenter rac database restore on VMware vVols storage');

1 row created.

SQL> commit;

Commit complete.

SQL> select * from test;

        ID
----------
DT
---------------------------------------------------------------------------
EVENT
--------------------------------------------------------------------------------
         1
19-AUG-24 10.36.04.000000 AM
validate SnapCenter rac database restore on VMware vVols storage


SQL>

....
. En la pestaña SnapCenter `Resources` , abra la página de topología de backup Database NTAP1. Destaque el conjunto de backup de datos de Snapshot creado hace 3 días. Haga clic en `Restore` para iniciar el flujo de trabajo de restauración-recuperación.
+
image:vcf_orarac_vvol_snapctr_restore_01.png["Captura de pantalla que muestra la configuración de SnapCenter."]

. Seleccione Restore Scope.
+
image:vcf_orarac_vvol_snapctr_restore_02.png["Captura de pantalla que muestra la configuración de SnapCenter."]

. Seleccione el ámbito de recuperación en `All Logs`.
+
image:vcf_orarac_vvol_snapctr_restore_03.png["Captura de pantalla que muestra la configuración de SnapCenter."]

. Especifique los scripts previos opcionales que se van a ejecutar.
+
image:vcf_orarac_vvol_snapctr_restore_04.png["Captura de pantalla que muestra la configuración de SnapCenter."]

. Especifique el archivo after-script opcional que se va a ejecutar.
+
image:vcf_orarac_vvol_snapctr_restore_05.png["Captura de pantalla que muestra la configuración de SnapCenter."]

. Envíe un informe de trabajo si lo desea.
+
image:vcf_orarac_vvol_snapctr_restore_06.png["Captura de pantalla que muestra la configuración de SnapCenter."]

. Revise el resumen y haga clic en `Finish` para iniciar la restauración y recuperación.
+
image:vcf_orarac_vvol_snapctr_restore_07.png["Captura de pantalla que muestra la configuración de SnapCenter."]

. A partir de la máquina virtual de la base de datos de RAC ora01, valide que la restauración/recuperación de la base de datos se haya reenviado correctamente a su estado más reciente y que se haya recuperado la tabla de prueba creada 3 días más tarde.
+
....

[root@ora01 ~]# su - oracle
[oracle@ora01 ~]$ sqlplus / as sysdba

SQL*Plus: Release 19.0.0.0.0 - Production on Mon Aug 19 11:51:15 2024
Version 19.18.0.0.0

Copyright (c) 1982, 2022, Oracle.  All rights reserved.


Connected to:
Oracle Database 19c Enterprise Edition Release 19.0.0.0.0 - Production
Version 19.18.0.0.0

SQL> select name, open_mode from v$database;

NAME      OPEN_MODE
--------- --------------------
NTAP      READ WRITE

SQL> sho pdbs

    CON_ID CON_NAME                       OPEN MODE  RESTRICTED
---------- ------------------------------ ---------- ----------
         2 PDB$SEED                       READ ONLY  NO
         3 NTAP_PDB1                      READ WRITE NO
         4 NTAP_PDB2                      READ WRITE NO
         5 NTAP_PDB3                      READ WRITE NO
SQL> alter session set container=ntap_pdb1;

Session altered.

SQL> select * from test;

        ID
----------
DT
---------------------------------------------------------------------------
EVENT
--------------------------------------------------------------------------------
         1
19-AUG-24 10.36.04.000000 AM
validate SnapCenter rac database restore on VMware vVols storage

SQL> select current_timestamp from dual;

CURRENT_TIMESTAMP
---------------------------------------------------------------------------
19-AUG-24 11.55.20.079686 AM -04:00



SQL> exit
Disconnected from Oracle Database 19c Enterprise Edition Release 19.0.0.0.0 - Production
Version 19.18.0.0.0

....


Esto completa la demostración del backup, la restauración y la recuperación de SnapCenter de la base de datos RAC de Oracle en VCF con vVols.

====


== Dónde encontrar información adicional

Si quiere más información sobre la información descrita en este documento, consulte los siguientes documentos o sitios web:

* Base de cloud de VMware
+
link:https://www.vmware.com/products/cloud-infrastructure/vmware-cloud-foundation["https://www.vmware.com/products/cloud-infrastructure/vmware-cloud-foundation"^]

* Soluciones de bases de datos empresariales de NetApp
+
link:https://docs.netapp.com/us-en/netapp-solutions/databases/index.html["https://docs.netapp.com/us-en/netapp-solutions/databases/index.html"^]

* Software SnapCenter 6.0
+
link:https://docs.netapp.com/us-en/snapcenter/concept/concept_snapcenter_overview.html["https://docs.netapp.com/us-en/snapcenter/concept/concept_snapcenter_overview.html"^]

* Documentación de las herramientas de ONTAP para VMware vSphere
+
link:https://docs.netapp.com/us-en/ontap-tools-vmware-vsphere/index.html["https://docs.netapp.com/us-en/ontap-tools-vmware-vsphere/index.html"^]



---
sidebar: sidebar 
permalink: databases/aws_ora_fsx_ec2_nfs_asm.html 
keywords: Oracle, AWS, FSx ONTAP, Database, Oracle ASM, Oracle Restart, Oracle 19c, NFS, dNFS 
summary: La solución ofrece información general y detallada para la implementación y la protección de bases de datos de Oracle en el almacenamiento de AWS FSx ONTAP y en la instancia de computación EC2 con el protocolo NFS y la base de datos de Oracle configurada en un reinicio independiente usando asm como administrador de volúmenes. 
---
= TR-4974: Oracle 19C en reinicio independiente en AWS FSx/EC2 con NFS/ASM
:hardbreaks:
:allow-uri-read: 
:nofooter: 
:icons: font
:linkattrs: 
:imagesdir: ./../media/


Allen Cao, Niyaz Mohamed, NetApp



== Específico

ASM (Automatic Storage Management, gestión automática de almacenamiento) es un gestor de volúmenes de almacenamiento de Oracle que se emplea en muchas instalaciones de Oracle. También es la solución de administración del almacenamiento recomendada por Oracle. Ofrece una alternativa a los administradores de volúmenes y los sistemas de archivos convencionales. Desde la versión 11g de Oracle, ASM se ha empaquetado con infraestructura de grid en lugar de con una base de datos. Por lo tanto, para utilizar Oracle ASM para la gestión del almacenamiento sin RAC, debe instalar la infraestructura de grid de Oracle en un servidor independiente, también conocido como Oracle Restart. Al hacerlo, agrega ciertamente mayor complejidad en una instalación de base de datos Oracle, que por lo demás es más sencilla. Sin embargo, como su nombre indica, cuando Oracle se pone en marcha en modo de reinicio, todos los servicios de Oracle fallidos se reinician después de reiniciar el host sin intervención del usuario, lo que proporciona un cierto grado de funciones de alta disponibilidad o alta disponibilidad.

Oracle ASM se implanta normalmente en protocolos de almacenamiento FC e iSCSI y lun como dispositivos de almacenamiento sin procesar. Sin embargo, ASM en el protocolo NFS y el sistema de archivos NFS también es compatible con la configuración de Oracle. En esta documentación mostramos cómo poner en marcha una base de datos de Oracle 19C con el protocolo NFS y Oracle ASM en un entorno de almacenamiento de Amazon FSx para ONTAP con instancias de computación de EC2:1. También mostramos cómo usar el servicio SnapCenter de NetApp a través de la consola BlueXP de NetApp para realizar tareas de backup, restauración y clonado de la base de datos de Oracle para desarrollo y pruebas u otros casos de uso para operaciones de bases de datos con una gestión eficiente del almacenamiento en el cloud público de AWS.

Esta solución aborda los siguientes casos prácticos:

* Puesta en marcha de la base de datos de Oracle en Amazon FSx para almacenamiento de ONTAP y instancias de computación EC2 con NFS/ASM
* Probar y validar una carga de trabajo de Oracle en el cloud público de AWS con NFS/ASM
* Probar y validar las funcionalidades de reinicio de bases de datos de Oracle implementadas en AWS




== Destinatarios

Esta solución está dirigida a las siguientes personas:

* Un administrador de bases de datos que desea implementar Oracle en un cloud público de AWS con NFS/ASM.
* Un arquitecto de soluciones de bases de datos que desea probar cargas de trabajo de Oracle en el cloud público de AWS.
* El administrador de almacenamiento que desea poner en marcha y gestionar una base de datos Oracle puesta en marcha en almacenamiento AWS FSX.
* Propietario de la aplicación que desea establecer una base de datos de Oracle en AWS FSX/EC2.




== Entorno de prueba y validación de la solución

Las pruebas y la validación de esta solución se llevaron a cabo en un entorno AWS FSX y EC2 que podría no coincidir con el entorno de puesta en marcha final. Para obtener más información, consulte la sección <<Key Factors for Deployment Consideration>>.



=== Arquitectura

image::aws_ora_fsx_ec2_nfs_asm_architecture.png[Esta imagen proporciona una imagen detallada de la configuración de la puesta en marcha de Oracle en el cloud público de AWS con iSCSI y ASM.]



=== Componentes de hardware y software

[cols="33%, 33%, 33%"]
|===


3+| *Hardware* 


| Almacenamiento FSX ONTAP | Versión actual ofrecida por AWS | Un clúster de alta disponibilidad FSX en el mismo VPC y la zona de disponibilidad 


| Instancia de EC2 para computación | t2.xlarge/4vCPU/16G | Dos instancias EC2 T2 xlarge EC2, una como servidor de base de datos principal y otra como servidor de base de datos clonada 


3+| *Software* 


| Red Hat Linux | RHEL-8.6.0_HVM-20220503-x86_64-2-Hourly2-GP2 | Suscripción RedHat implementada para pruebas 


| Infraestructura de Grid de Oracle | Versión 19.18 | Parche RU aplicado p34762026_190000_Linux-x86-64.zip 


| Base de datos Oracle | Versión 19.18 | Parche RU aplicado p34765931_190000_Linux-x86-64.zip 


| Oracle OPatch | Versión 12.2.0.1.36 | Último parche p6880880_190000_Linux-x86-64.zip 


| Servicio SnapCenter | Versión | v2.3.1.2324 
|===


=== Factores clave a tener en cuenta la puesta en marcha

* *Instancias de computación EC2.* en estas pruebas y validaciones, utilizamos un tipo de instancia AWS EC2 t2.xlarge para la instancia de computación de base de datos Oracle. NetApp recomienda utilizar una instancia de EC2 de tipo M5 como instancia informática para Oracle en la puesta en marcha de producción porque está optimizada para las cargas de trabajo de las bases de datos. Debe ajustar el tamaño de la instancia de EC2 según el número de vCPU y la cantidad de RAM en función de los requisitos de las cargas de trabajo reales.
* *Implementación de clústeres de alta disponibilidad de almacenamiento FSX de una o varias zonas.* en estas pruebas y validaciones, implementamos un clúster de alta disponibilidad FSX en una única zona de disponibilidad de AWS. Para la puesta en marcha en producción, NetApp recomienda la puesta en marcha de un par de alta disponibilidad FSX en dos zonas de disponibilidad diferentes. Un clúster de alta disponibilidad FSX se aprovisiona en una pareja de alta disponibilidad que se sincroniza con un par de sistemas de archivos activo-pasivo para proporcionar redundancia a nivel de almacenamiento. La puesta en marcha de varias zonas mejora aún más la alta disponibilidad en caso de fallo en una única zona de AWS.
* *Ajuste de tamaño del clúster de almacenamiento FSX.* un sistema de archivos de almacenamiento Amazon FSX para ONTAP proporciona hasta 160,000 IOPS SSD sin configurar, un rendimiento de hasta 4 Gbps y una capacidad máxima de 192 TIB. Sin embargo, puede ajustar el tamaño del clúster en términos de IOPS aprovisionadas, rendimiento y el límite de almacenamiento (mínimo de 1,024 GIB) según sus requisitos reales en el momento de la implementación. La capacidad se puede ajustar de forma dinámica y sobre la marcha sin que se vea afectada la disponibilidad de las aplicaciones.
* *Disposición de registros y datos de Oracle.* en nuestras pruebas y validaciones, implementamos dos grupos de discos ASM para datos y registros respectivamente. Dentro del grupo de discos +DATA asm, aprovisionamos cuatro discos en un punto de montaje del sistema de archivos data nfs. Dentro del grupo de discos asm +LOGS, aprovisionamos dos discos en un punto de montaje del sistema de archivos NFS de logs. Para la puesta en marcha de grandes bases de datos, se pueden crear grupos de discos de ASM para abarcar diversos sistemas de archivos FSx con discos NFS de ASM distribuidos a través de múltiples puntos de montaje de NFS anclados en los sistemas de archivos FSx. Esta configuración en particular está diseñada para satisfacer el rendimiento de las bases de datos por encima de un rendimiento de 4Gbps GB y un requisito de IOPS de 160.000 TB sin configurar SSD.
* *Configuración dNFS.* dNFS está integrado en el kernel de Oracle y se sabe que aumenta drásticamente el rendimiento de la base de datos Oracle cuando Oracle se implementa en el almacenamiento NFS. DNFS se empaqueta en el binario de Oracle, pero no se activa por defecto. Debe activarse para cualquier puesta en marcha de bases de datos de Oracle en NFS. Para la implementación de varios sistemas de archivos FSX para bases de datos grandes, la multiruta dNFS debe estar configurada correctamente.
* *Nivel de redundancia de Oracle ASM para usar para cada grupo de discos de Oracle ASM que cree.* Debido a que FSX ya refleja el almacenamiento en el nivel de clúster de FSx, debería hacerlo `ONLY` Utilizar redundancia externa, lo que significa que la opción no permite a Oracle ASM reflejar el contenido del grupo de discos. Esto es especialmente importante, ya que el almacenamiento de datos de la base de datos de NFS para Oracle requiere una opción de montaje HARD NFS, que NO es deseable para el mirroring de contenido de ASM en el nivel de Oracle.
* *Backup de base de datos.* NetApp proporciona una versión SaaS del servicio de software SnapCenter para backup, restauración y clonado de bases de datos en el cloud que está disponible a través de la interfaz de usuario de la consola BlueXP de NetApp. NetApp recomienda implantar este servicio para conseguir un backup de snapshot rápido (menos de un minuto), una restauración rápida de bases de datos y un clonado de bases de datos.




== Puesta en marcha de la solución

En la siguiente sección se proporcionan procedimientos de puesta en marcha paso a paso.



=== Requisitos previos para la implementación

[%collapsible]
====
La implementación requiere los siguientes requisitos previos.

. Se configuró una cuenta de AWS y se crearon el VPC y los segmentos de red necesarios en la cuenta de AWS.
. Desde la consola EC2 de AWS, debe poner en marcha dos instancias EC2 Linux, una como servidor de bases de datos Oracle principal y un servidor de bases de datos de destino de clones alternativo opcional. Consulte el diagrama de arquitectura de la sección anterior para obtener más información sobre la configuración del entorno. Revise también la link:https://docs.aws.amazon.com/AWSEC2/latest/UserGuide/concepts.html["Guía de usuario para instancias de Linux"^] si quiere más información.
. Desde la consola de AWS EC2, implemente clústeres de alta disponibilidad de almacenamiento de Amazon FSX para ONTAP a fin de alojar los volúmenes de la base de datos Oracle. Si no está familiarizado con la implementación de almacenamiento FSX, consulte la documentación link:https://docs.aws.amazon.com/fsx/latest/ONTAPGuide/creating-file-systems.html["Creación de FSX para sistemas de archivos ONTAP"^] para obtener instrucciones paso a paso.
. Los pasos 2 y 3 se pueden realizar utilizando el siguiente kit de herramientas de automatización de Terraform, que crea una instancia de EC2 denominada `ora_01` Y un sistema de archivos FSX llamado `fsx_01`. Revise las instrucciones detenidamente y cambie las variables para adaptarlas a su entorno antes de su ejecución.
+
....
git clone https://github.com/NetApp-Automation/na_aws_fsx_ec2_deploy.git
....



NOTE: Asegúrese de haber asignado al menos 50g en el volumen raíz de la instancia EC2 para tener espacio suficiente para almacenar en zona intermedia los archivos de instalación de Oracle.

====


=== Configuración del kernel de la instancia de EC2

[%collapsible]
====
Con los requisitos previos aprovisionados, inicie sesión en la instancia de EC2 como usuario EC2 y sudo como usuario root para configurar el núcleo de Linux para la instalación de Oracle.

. Crear un directorio provisional `/tmp/archive` y establezca la `777` permiso.
+
....
mkdir /tmp/archive

chmod 777 /tmp/archive
....
. Descargue y prepare los archivos de instalación binarios de Oracle y otros archivos RPM necesarios en el `/tmp/archive` directorio.
+
Consulte la siguiente lista de archivos de instalación que se deben incluir en la `/tmp/archive` En la instancia de EC2.

+
....
[ec2-user@ip-172-30-15-58 ~]$ ls -l /tmp/archive
total 10537316
-rw-rw-r--. 1 ec2-user ec2-user      19112 Mar 21 15:57 compat-libcap1-1.10-7.el7.x86_64.rpm
-rw-rw-r--  1 ec2-user ec2-user 3059705302 Mar 21 22:01 LINUX.X64_193000_db_home.zip
-rw-rw-r--  1 ec2-user ec2-user 2889184573 Mar 21 21:09 LINUX.X64_193000_grid_home.zip
-rw-rw-r--. 1 ec2-user ec2-user     589145 Mar 21 15:56 netapp_linux_unified_host_utilities-7-1.x86_64.rpm
-rw-rw-r--. 1 ec2-user ec2-user      31828 Mar 21 15:55 oracle-database-preinstall-19c-1.0-2.el8.x86_64.rpm
-rw-rw-r--  1 ec2-user ec2-user 2872741741 Mar 21 22:31 p34762026_190000_Linux-x86-64.zip
-rw-rw-r--  1 ec2-user ec2-user 1843577895 Mar 21 22:32 p34765931_190000_Linux-x86-64.zip
-rw-rw-r--  1 ec2-user ec2-user  124347218 Mar 21 22:33 p6880880_190000_Linux-x86-64.zip
-rw-r--r--  1 ec2-user ec2-user     257136 Mar 22 16:25 policycoreutils-python-utils-2.9-9.el8.noarch.rpm
....
. Instalar Oracle 19c preinstall RPM, que cumple la mayoría de los requisitos de configuración del kernel.
+
....
yum install /tmp/archive/oracle-database-preinstall-19c-1.0-2.el8.x86_64.rpm
....
. Descargue e instale lo que falta `compat-libcap1` En Linux 8.
+
....
yum install /tmp/archive/compat-libcap1-1.10-7.el7.x86_64.rpm
....
. En NetApp, descargue e instale las utilidades del host de NetApp.
+
....
yum install /tmp/archive/netapp_linux_unified_host_utilities-7-1.x86_64.rpm
....
. Instale `policycoreutils-python-utils`, Que no está disponible en la instancia de EC2.
+
....
yum install /tmp/archive/policycoreutils-python-utils-2.9-9.el8.noarch.rpm
....
. Instale JDK abierto versión 1.8.
+
....
yum install java-1.8.0-openjdk.x86_64
....
. Instale nfs-utils.
+
....
yum install nfs-utils
....
. Desactive hugepages transparentes en el sistema actual.
+
....
echo never > /sys/kernel/mm/transparent_hugepage/enabled
echo never > /sys/kernel/mm/transparent_hugepage/defrag
....
+
Añada las siguientes líneas en `/etc/rc.local` para desactivarla `transparent_hugepage` después del reinicio:

+
....
  # Disable transparent hugepages
          if test -f /sys/kernel/mm/transparent_hugepage/enabled; then
            echo never > /sys/kernel/mm/transparent_hugepage/enabled
          fi
          if test -f /sys/kernel/mm/transparent_hugepage/defrag; then
            echo never > /sys/kernel/mm/transparent_hugepage/defrag
          fi
....
. Desactive selinux cambiando `SELINUX=enforcing` para `SELINUX=disabled`. Debe reiniciar el host para que el cambio sea efectivo.
+
....
vi /etc/sysconfig/selinux
....
. Añada las siguientes líneas a. `limit.conf` para establecer el límite del descriptor de archivo y el tamaño de pila sin comillas `" "`.
+
....
vi /etc/security/limits.conf
  "*               hard    nofile          65536"
  "*               soft    stack           10240"
....
. Siga esta instrucción para agregar espacio de intercambio a la instancia de EC2: link:https://aws.amazon.com/premiumsupport/knowledge-center/ec2-memory-swap-file/["¿Cómo puedo asignar memoria para que funcione como espacio de intercambio en una instancia de Amazon EC2 utilizando un archivo de intercambio?"^] La cantidad exacta de espacio que se debe agregar depende del tamaño de RAM hasta 16 GB.
. Añada el grupo ASM que se utilizará para el grupo sysasm de asm
+
....
groupadd asm
....
. Modifique el usuario de oracle para agregar ASM como grupo secundario (el usuario de oracle debe haberse creado después de la instalación de RPM de Oracle preinstall).
+
....
usermod -a -G asm oracle
....
. Reinicie la instancia de EC2.


====


=== Aprovisione y exporte volúmenes de NFS que se montarán en un host de EC2 instancias

[%collapsible]
====
Aprovisionar tres volúmenes desde la línea de comandos iniciando sesión en el clúster FSx a través de ssh como usuario fsxadmin con la IP de administración de clúster de FSx para alojar los archivos binarios, de datos y de registros de la base de datos de Oracle.

. Inicie sesión en el clúster FSX a través de SSH como usuario fsxadmin.
+
....
ssh fsxadmin@172.30.15.53
....
. Ejecute el comando siguiente para crear un volumen para el binario de Oracle.
+
....
vol create -volume ora_01_biny -aggregate aggr1 -size 50G -state online  -type RW -junction-path /ora_01_biny -snapshot-policy none -tiering-policy snapshot-only
....
. Ejecute el siguiente comando para crear un volumen para los datos de Oracle.
+
....
vol create -volume ora_01_data -aggregate aggr1 -size 100G -state online  -type RW -junction-path /ora_01_data -snapshot-policy none -tiering-policy snapshot-only
....
. Ejecute el siguiente comando para crear un volumen para los registros de Oracle.
+
....
vol create -volume ora_01_logs -aggregate aggr1 -size 100G -state online  -type RW -junction-path /ora_01_logs -snapshot-policy none -tiering-policy snapshot-only
....
. Valide los volúmenes de base de datos creados.
+
....
vol show
....
+
Se espera que esta declaración devuelva:

+
....
FsxId02ad7bf3476b741df::> vol show
  (vol show)
FsxId06c3c8b2a7bd56458::> vol show
Vserver   Volume       Aggregate    State      Type       Size  Available Used%
--------- ------------ ------------ ---------- ---- ---------- ---------- -----
svm_ora   ora_01_biny  aggr1        online     RW         50GB    47.50GB    0%
svm_ora   ora_01_data  aggr1        online     RW        100GB    95.00GB    0%
svm_ora   ora_01_logs  aggr1        online     RW        100GB    95.00GB    0%
svm_ora   svm_ora_root aggr1        online     RW          1GB    972.1MB    0%
4 entries were displayed.
....


====


=== Configuración de almacenamiento de base de datos

[%collapsible]
====
Ahora, importe y configure el almacenamiento FSX para la instalación de la base de datos y la infraestructura de grid de Oracle en el host de la instancia de EC2.

. Inicie sesión en la instancia de EC2 a través de SSH como el usuario EC2 con su clave SSH y la dirección IP de la instancia EC2.
+
....
ssh -i ora_01.pem ec2-user@172.30.15.58
....
. Cree el directorio /u01 para montar el sistema de archivos binarios de Oracle
+
....
sudo mkdir /u01
....
. Monte el volumen binario a. `/u01`, Cambiado a su dirección IP de FSX NFS lif. Si ha puesto en marcha el cluster FSx a través del kit de herramientas de automatización de NetApp, la dirección IP lif NFS de servidor de almacenamiento virtual de FSx se enumerará en la salida al final de la ejecución del aprovisionamiento de recursos. De lo contrario, puede recuperarse a partir de la IU de la consola de AWS FSx.
+
....
sudo mount -t nfs 172.30.15.19:/ora_01_biny /u01 -o rw,bg,hard,vers=3,proto=tcp,timeo=600,rsize=65536,wsize=65536
....
. Cambiar `/u01` Propiedad de punto de montaje para el usuario oracle y su grupo primario asociado.
+
....
sudo chown oracle:oinstall /u01
....
. Cree el directorio /oradata para montar el sistema de archivos de datos de Oracle
+
....
sudo mkdir /oradata
....
. Monte el volumen de datos a. `/oradata`, Cambiado a su dirección IP de FSX NFS lif
+
....
sudo mount -t nfs 172.30.15.19:/ora_01_data /oradata -o rw,bg,hard,vers=3,proto=tcp,timeo=600,rsize=65536,wsize=65536
....
. Cambiar `/oradata` Propiedad de punto de montaje para el usuario oracle y su grupo primario asociado.
+
....
sudo chown oracle:oinstall /oradata
....
. Cree el directorio /oralogs para montar el sistema de archivos de Oracle logs
+
....
sudo mkdir /oralogs
....
. Monte el volumen de registro a. `/oralogs`, Cambiado a su dirección IP de FSX NFS lif
+
....
sudo mount -t nfs 172.30.15.19:/ora_01_logs /oralogs -o rw,bg,hard,vers=3,proto=tcp,timeo=600,rsize=65536,wsize=65536
....
. Cambiar `/oralogs` Propiedad de punto de montaje para el usuario oracle y su grupo primario asociado.
+
....
sudo chown oracle:oinstall /oralogs
....
. Agregue un punto de montaje a. `/etc/fstab`.
+
....
sudo vi /etc/fstab
....
+
Añada la siguiente línea.

+
....
172.30.15.19:/ora_01_biny       /u01            nfs     rw,bg,hard,vers=3,proto=tcp,timeo=600,rsize=65536,wsize=65536   0       0
172.30.15.19:/ora_01_data       /oradata        nfs     rw,bg,hard,vers=3,proto=tcp,timeo=600,rsize=65536,wsize=65536   0       0
172.30.15.19:/ora_01_logs       /oralogs        nfs     rw,bg,hard,vers=3,proto=tcp,timeo=600,rsize=65536,wsize=65536   0       0

....
. sudo para el usuario oracle, cree carpetas de asm para almacenar archivos de disco de asm
+
....
sudo su
su - oracle
mkdir /oradata/asm
mkdir /oralogs/asm
....
. Como usuario oracle, cree archivos de disco de datos de asm, cambie el recuento para que coincida con el tamaño del disco con el tamaño del bloque.
+
....
dd if=/dev/zero of=/oradata/asm/nfs_data_disk01 bs=1M count=20480 oflag=direct
dd if=/dev/zero of=/oradata/asm/nfs_data_disk02 bs=1M count=20480 oflag=direct
dd if=/dev/zero of=/oradata/asm/nfs_data_disk03 bs=1M count=20480 oflag=direct
dd if=/dev/zero of=/oradata/asm/nfs_data_disk04 bs=1M count=20480 oflag=direct
....
. Como usuario root, cambie el permiso del archivo de disco de datos a 640
+
....
chmod 640 /oradata/asm/*
....
. COMO usuario oracle, cree archivos de disco de logs de asm, cambie a recuento para que coincida con el tamaño del disco con el tamaño del bloque.
+
....
dd if=/dev/zero of=/oralogs/asm/nfs_logs_disk01 bs=1M count=40960 oflag=direct
dd if=/dev/zero of=/oralogs/asm/nfs_logs_disk02 bs=1M count=40960 oflag=direct
....
. Como usuario raíz, cambie el permiso del archivo de registro a 640
+
....
chmod 640 /oralogs/asm/*
....
. Reinicie el host de la instancia de EC2.


====


=== Instalación de la infraestructura Grid de Oracle

[%collapsible]
====
. Inicie sesión en la instancia de EC2 como usuario de ec2 a través de SSH y habilite la autenticación de contraseñas sin comentarios `PasswordAuthentication yes` y después comentar `PasswordAuthentication no`.
+
....
sudo vi /etc/ssh/sshd_config
....
. Reinicie el servicio sshd.
+
....
sudo systemctl restart sshd
....
. Restablecer la contraseña de usuario de Oracle.
+
....
sudo passwd oracle
....
. Inicie sesión como el usuario propietario de software de Oracle Restart (oracle). Cree un directorio de Oracle del siguiente modo:
+
....
mkdir -p /u01/app/oracle
mkdir -p /u01/app/oraInventory
....
. Cambie la configuración de permisos de directorio.
+
....
chmod -R 775 /u01/app
....
. Cree un directorio principal de la cuadrícula y cámbielo.
+
....
mkdir -p /u01/app/oracle/product/19.0.0/grid
cd /u01/app/oracle/product/19.0.0/grid
....
. Descomprima los archivos de instalación de grid.
+
....
unzip -q /tmp/archive/LINUX.X64_193000_grid_home.zip
....
. En el inicio de la cuadrícula, elimine `OPatch` directorio.
+
....
rm -rf OPatch
....
. Desde el inicio de la cuadrícula, copiar `p6880880_190000_Linux-x86-64.zip` a grid_home y, a continuación, descomprimirlo.
+
....
cp /tmp/archive/p6880880_190000_Linux-x86-64.zip .
unzip p6880880_190000_Linux-x86-64.zip
....
. Desde el inicio de la cuadrícula, revisar `cv/admin/cvu_config`, descomentar y reemplazar `CV_ASSUME_DISTID=OEL5` con `CV_ASSUME_DISTID=OL7`.
+
....
vi cv/admin/cvu_config
....
. Prepare un `gridsetup.rsp` archivo para la instalación silenciosa y coloque el archivo rsp en el `/tmp/archive` directorio. El archivo rsp debe cubrir las secciones A, B y G con la siguiente información:
+
....
INVENTORY_LOCATION=/u01/app/oraInventory
oracle.install.option=HA_CONFIG
ORACLE_BASE=/u01/app/oracle
oracle.install.asm.OSDBA=dba
oracle.install.asm.OSOPER=oper
oracle.install.asm.OSASM=asm
oracle.install.asm.SYSASMPassword="SetPWD"
oracle.install.asm.diskGroup.name=DATA
oracle.install.asm.diskGroup.redundancy=EXTERNAL
oracle.install.asm.diskGroup.AUSize=4
oracle.install.asm.diskGroup.disks=/oradata/asm/*,/oralogs/asm/*
oracle.install.asm.diskGroup.diskDiscoveryString=/oradata/asm/nfs_data_disk01,/oradata/asm/nfs_data_disk02,/oradata/asm/nfs_data_disk03,/oradata/asm/nfs_data_disk04
oracle.install.asm.monitorPassword="SetPWD"
oracle.install.asm.configureAFD=false
....
. Inicie sesión en la instancia EC2 como usuario root.
. Instale `cvuqdisk-1.0.10-1.rpm`.
+
....
rpm -ivh /u01/app/oracle/product/19.0.0/grid/cv/rpm/cvuqdisk-1.0.10-1.rpm
....
. Inicie sesión en la instancia de EC2 como usuario de Oracle y extraiga el parche en `/tmp/archive` carpeta.
+
....
unzip p34762026_190000_Linux-x86-64.zip
....
. Desde el directorio raíz de grid /u01/app/oracle/product/19,0.0/grid y, como usuario oracle, inicie `gridSetup.sh` para la instalación de la infraestructura grid.
+
....
 ./gridSetup.sh -applyRU /tmp/archive/34762026/ -silent -responseFile /tmp/archive/gridsetup.rsp
....
+
Ignore las advertencias sobre grupos incorrectos para la infraestructura de la red. Utilizamos un solo usuario de Oracle para gestionar el reinicio de Oracle, por lo que se espera lo siguiente.

. Como usuario root, ejecute los siguientes scripts:
+
....
/u01/app/oraInventory/orainstRoot.sh

/u01/app/oracle/product/19.0.0/grid/root.sh
....
. Como usuario de Oracle, ejecute el siguiente comando para completar la configuración:
+
....
/u01/app/oracle/product/19.0.0/grid/gridSetup.sh -executeConfigTools -responseFile /tmp/archive/gridsetup.rsp -silent
....
. Como usuario de Oracle, cree el grupo DE discos DE REGISTROS.
+
....
bin/asmca -silent -sysAsmPassword 'yourPWD' -asmsnmpPassword 'yourPWD' -createDiskGroup -diskGroupName LOGS -disk '/oralogs/asm/nfs_logs_disk*' -redundancy EXTERNAL -au_size 4
....
. Como usuario de Oracle, valide los servicios de grid tras la configuración de la instalación.
+
....
bin/crsctl stat res -t
+
Name                Target  State        Server                   State details
Local Resources
ora.DATA.dg         ONLINE  ONLINE       ip-172-30-15-58          STABLE
ora.LISTENER.lsnr   ONLINE  ONLINE       ip-172-30-15-58          STABLE
ora.LOGS.dg         ONLINE  ONLINE       ip-172-30-15-58          STABLE
ora.asm             ONLINE  ONLINE       ip-172-30-15-58          Started,STABLE
ora.ons             OFFLINE OFFLINE      ip-172-30-15-58          STABLE
Cluster Resources
ora.cssd            ONLINE  ONLINE       ip-172-30-15-58          STABLE
ora.diskmon         OFFLINE OFFLINE                               STABLE
ora.driver.afd      ONLINE  ONLINE       ip-172-30-15-58          STABLE
ora.evmd            ONLINE  ONLINE       ip-172-30-15-58          STABLE
....


====


=== Instalación de bases de datos de Oracle

[%collapsible]
====
. Inicie sesión como usuario de Oracle y desconéctese `$ORACLE_HOME` y.. `$ORACLE_SID` si está configurado.
+
....
unset ORACLE_HOME
unset ORACLE_SID
....
. Cree el directorio inicial de Oracle DB y cámbielo.
+
....
mkdir /u01/app/oracle/product/19.0.0/db1
cd /u01/app/oracle/product/19.0.0/db1
....
. Descomprima los archivos de instalación de la base de datos Oracle.
+
....
unzip -q /tmp/archive/LINUX.X64_193000_db_home.zip
....
. En el inicio de la base de datos, elimine `OPatch` directorio.
+
....
rm -rf OPatch
....
. Desde el inicio de la base de datos, copiar `p6880880_190000_Linux-x86-64.zip` para `grid_home`, y luego descomprimirlo.
+
....
cp /tmp/archive/p6880880_190000_Linux-x86-64.zip .
unzip p6880880_190000_Linux-x86-64.zip
....
. Desde el inicio de DB, revisar `cv/admin/cvu_config`, y descomentar y reemplazar `CV_ASSUME_DISTID=OEL5` con `CV_ASSUME_DISTID=OL7`.
+
....
vi cv/admin/cvu_config
....
. Desde la `/tmp/archive` directorio, desembale el parche DB 19.18 RU.
+
....
unzip p34765931_190000_Linux-x86-64.zip
....
. Prepare el archivo rsp de instalación silenciosa de la base de datos en `/tmp/archive/dbinstall.rsp` directorio con los siguientes valores:
+
....
oracle.install.option=INSTALL_DB_SWONLY
UNIX_GROUP_NAME=oinstall
INVENTORY_LOCATION=/u01/app/oraInventory
ORACLE_HOME=/u01/app/oracle/product/19.0.0/db1
ORACLE_BASE=/u01/app/oracle
oracle.install.db.InstallEdition=EE
oracle.install.db.OSDBA_GROUP=dba
oracle.install.db.OSOPER_GROUP=oper
oracle.install.db.OSBACKUPDBA_GROUP=oper
oracle.install.db.OSDGDBA_GROUP=dba
oracle.install.db.OSKMDBA_GROUP=dba
oracle.install.db.OSRACDBA_GROUP=dba
oracle.install.db.rootconfig.executeRootScript=false
....
. Desde db1 home /u01/app/oracle/product/19,0.0/db1, ejecute una instalación silenciosa de bases de datos solo de software.
+
....
 ./runInstaller -applyRU /tmp/archive/34765931/ -silent -ignorePrereqFailure -responseFile /tmp/archive/dbinstall.rsp
....
. Como usuario raíz, ejecute el `root.sh` secuencia de comandos después de la instalación sólo de software.
+
....
/u01/app/oracle/product/19.0.0/db1/root.sh
....
. Como usuario oracle, cree el `dbca.rsp` archivo con las siguientes entradas:
+
....
gdbName=db1.demo.netapp.com
sid=db1
createAsContainerDatabase=true
numberOfPDBs=3
pdbName=db1_pdb
useLocalUndoForPDBs=true
pdbAdminPassword="yourPWD"
templateName=General_Purpose.dbc
sysPassword="yourPWD"
systemPassword="yourPWD"
dbsnmpPassword="yourPWD"
storageType=ASM
diskGroupName=DATA
characterSet=AL32UTF8
nationalCharacterSet=AL16UTF16
listeners=LISTENER
databaseType=MULTIPURPOSE
automaticMemoryManagement=false
totalMemory=8192
....
+

NOTE: Defina la memoria total en función de la memoria disponible en el host de instancia EC2. Oracle asigna el 75 % de `totalMemory` En la caché de buffers o SGA de la instancia de base de datos.

. Como usuario oracle, inicie la creación de la base de datos con dbca.
+
....
bin/dbca -silent -createDatabase -responseFile /tmp/archive/dbca.rsp

output:
Prepare for db operation
7% complete
Registering database with Oracle Restart
11% complete
Copying database files
33% complete
Creating and starting Oracle instance
35% complete
38% complete
42% complete
45% complete
48% complete
Completing Database Creation
53% complete
55% complete
56% complete
Creating Pluggable Databases
60% complete
64% complete
69% complete
78% complete
Executing Post Configuration Actions
100% complete
Database creation complete. For details check the logfiles at:
 /u01/app/oracle/cfgtoollogs/dbca/db1.
Database Information:
Global Database Name:db1.demo.netapp.com
System Identifier(SID):db1
Look at the log file "/u01/app/oracle/cfgtoollogs/dbca/db1/db1.log" for further details.
....
. Como usuario oracle, valide los servicios de Oracle Restart HA después de la creación de la base de datos.
+
....
[oracle@ip-172-30-15-58 db1]$ ../grid/bin/crsctl stat res -t
--------------------------------------------------------------------------------
Name           Target  State        Server                   State details
--------------------------------------------------------------------------------
Local Resources
--------------------------------------------------------------------------------
ora.DATA.dg
               ONLINE  ONLINE       ip-172-30-15-58          STABLE
ora.LISTENER.lsnr
               ONLINE  ONLINE       ip-172-30-15-58          STABLE
ora.LOGS.dg
               ONLINE  ONLINE       ip-172-30-15-58          STABLE
ora.asm
               ONLINE  ONLINE       ip-172-30-15-58          Started,STABLE
ora.ons
               OFFLINE OFFLINE      ip-172-30-15-58          STABLE
--------------------------------------------------------------------------------
Cluster Resources
--------------------------------------------------------------------------------
ora.cssd
      1        ONLINE  ONLINE       ip-172-30-15-58          STABLE
ora.db1.db
      1        ONLINE  ONLINE       ip-172-30-15-58          Open,HOME=/u01/app/o
                                                             racle/product/19.0.0
                                                             /db1,STABLE
ora.diskmon
      1        OFFLINE OFFLINE                               STABLE
ora.evmd
      1        ONLINE  ONLINE       ip-172-30-15-58          STABLE
--------------------------------------------------------------------------------
[oracle@ip-172-30-15-58 db1]$

....
. Defina el usuario Oracle `.bash_profile`.
+
....
vi ~/.bash_profile
....
. Agregar las siguientes entradas:
+
....
export ORACLE_HOME=/u01/app/oracle/product/19.0.0/db1
export ORACLE_SID=db1
export PATH=$PATH:$ORACLE_HOME/bin
alias asm='export ORACLE_HOME=/u01/app/oracle/product/19.0.0/grid;export ORACLE_SID=+ASM;export PATH=$PATH:$ORACLE_HOME/bin'
....
. Validar la CDB/PDB creada.
+
....
. ~/.bash_profile

sqlplus / as sysdba

SQL> select name, open_mode from v$database;

NAME      OPEN_MODE

DB1       READ WRITE

SQL> select name from v$datafile;

NAME

+DATA/DB1/DATAFILE/system.256.1132176177
+DATA/DB1/DATAFILE/sysaux.257.1132176221
+DATA/DB1/DATAFILE/undotbs1.258.1132176247
+DATA/DB1/86B637B62FE07A65E053F706E80A27CA/DATAFILE/system.265.1132177009
+DATA/DB1/86B637B62FE07A65E053F706E80A27CA/DATAFILE/sysaux.266.1132177009
+DATA/DB1/DATAFILE/users.259.1132176247
+DATA/DB1/86B637B62FE07A65E053F706E80A27CA/DATAFILE/undotbs1.267.1132177009
+DATA/DB1/F7852758DCD6B800E0533A0F1EAC1DC6/DATAFILE/system.271.1132177853
+DATA/DB1/F7852758DCD6B800E0533A0F1EAC1DC6/DATAFILE/sysaux.272.1132177853
+DATA/DB1/F7852758DCD6B800E0533A0F1EAC1DC6/DATAFILE/undotbs1.270.1132177853
+DATA/DB1/F7852758DCD6B800E0533A0F1EAC1DC6/DATAFILE/users.274.1132177871

NAME

+DATA/DB1/F785288BBCD1BA78E0533A0F1EACCD6F/DATAFILE/system.276.1132177871
+DATA/DB1/F785288BBCD1BA78E0533A0F1EACCD6F/DATAFILE/sysaux.277.1132177871
+DATA/DB1/F785288BBCD1BA78E0533A0F1EACCD6F/DATAFILE/undotbs1.275.1132177871
+DATA/DB1/F785288BBCD1BA78E0533A0F1EACCD6F/DATAFILE/users.279.1132177889
+DATA/DB1/F78529A14DD8BB18E0533A0F1EACB8ED/DATAFILE/system.281.1132177889
+DATA/DB1/F78529A14DD8BB18E0533A0F1EACB8ED/DATAFILE/sysaux.282.1132177889
+DATA/DB1/F78529A14DD8BB18E0533A0F1EACB8ED/DATAFILE/undotbs1.280.1132177889
+DATA/DB1/F78529A14DD8BB18E0533A0F1EACB8ED/DATAFILE/users.284.1132177907

19 rows selected.

SQL> show pdbs

    CON_ID CON_NAME                       OPEN MODE  RESTRICTED

         2 PDB$SEED                       READ ONLY  NO
         3 DB1_PDB1                       READ WRITE NO
         4 DB1_PDB2                       READ WRITE NO
         5 DB1_PDB3                       READ WRITE NO
SQL>
....
. Como usuario de oracle, cambie al directorio raíz de la base de datos Oracle /u01/app/oracle/product/19,0.0/db1 y habilite dNFS
+
....
cd /u01/app/oracle/product/19.0.0/db1

mkdir rdbms/lib/odm

cp lib/libnfsodm19.so rdbms/lib/odm/
....
. Configure el archivo oranfstab en ORACLE_HOME
+
....
vi $ORACLE_HOME/dbs/oranfstab

add following entries:

server: fsx_01
local: 172.30.15.58 path: 172.30.15.19
nfs_version: nfsv3
export: /ora_01_biny mount: /u01
export: /ora_01_data mount: /oradata
export: /ora_01_logs mount: /oralogs
....
. Como usuario oracle, conéctese a la base de datos desde sqlplus y defina el tamaño y la ubicación de la recuperación de la base de datos en el grupo de discos +LOGS.
+
....

. ~/.bash_profile

sqlplus / as sysdba

alter system set db_recovery_file_dest_size = 80G scope=both;

alter system set db_recovery_file_dest = '+LOGS' scope=both;
....
. Active el modo archive log y reinicie la instancia de Oracle DB
+
....

shutdown immediate;

startup mount;

alter database archivelog;

alter database open;

alter system switch logfile;

....
. Valide el modo log de la base de datos y dNFS después del reinicio de la instancia
+
....

SQL> select name, log_mode from v$database;

NAME      LOG_MODE
--------- ------------
DB1       ARCHIVELOG

SQL> select svrname, dirname from v$dnfs_servers;

SVRNAME
--------------------------------------------------------------------------------
DIRNAME
--------------------------------------------------------------------------------
fsx_01
/ora_01_data

fsx_01
/ora_01_biny

fsx_01
/ora_01_logs

....
. Validar Oracle ASM
+
....
[oracle@ip-172-30-15-58 db1]$ asm
[oracle@ip-172-30-15-58 db1]$ sqlplus / as sysasm

SQL*Plus: Release 19.0.0.0.0 - Production on Tue May 9 20:39:39 2023
Version 19.18.0.0.0

Copyright (c) 1982, 2022, Oracle.  All rights reserved.


Connected to:
Oracle Database 19c Enterprise Edition Release 19.0.0.0.0 - Production
Version 19.18.0.0.0

SQL> set lin 200
SQL> col path form a30
SQL> select name, path, header_status, mount_status, state from v$asm_disk;

NAME                           PATH                           HEADER_STATU MOUNT_S STATE
------------------------------ ------------------------------ ------------ ------- --------
DATA_0002                      /oradata/asm/nfs_data_disk01   MEMBER       CACHED  NORMAL
DATA_0000                      /oradata/asm/nfs_data_disk02   MEMBER       CACHED  NORMAL
DATA_0001                      /oradata/asm/nfs_data_disk03   MEMBER       CACHED  NORMAL
DATA_0003                      /oradata/asm/nfs_data_disk04   MEMBER       CACHED  NORMAL
LOGS_0000                      /oralogs/asm/nfs_logs_disk01   MEMBER       CACHED  NORMAL
LOGS_0001                      /oralogs/asm/nfs_logs_disk02   MEMBER       CACHED  NORMAL

6 rows selected.


SQL> select name, state, ALLOCATION_UNIT_SIZE, TOTAL_MB, FREE_MB from v$asm_diskgroup;

NAME                           STATE       ALLOCATION_UNIT_SIZE   TOTAL_MB    FREE_MB
------------------------------ ----------- -------------------- ---------- ----------
DATA                           MOUNTED                  4194304      81920      73536
LOGS                           MOUNTED                  4194304      81920      81640

This completes Oracle 19c version 19.18 Restart deployment on an Amazon FSx for ONTAP and EC2 compute instance with NFS/ASM. If desired, NetApp recommends relocating the Oracle control file and online log files to the +LOGS disk group.
....


====


=== Opción de implementación automatizada

NetApp lanzará un kit de herramientas de puesta en marcha de soluciones totalmente automatizado con Ansible para facilitar la implementación de esta solución. Por favor, vuelva a comprobar la disponibilidad del kit de herramientas. Después de que se publique, se publicará un enlace aquí.



== Backup, restauración y clonado de bases de datos de Oracle con el servicio SnapCenter

En este momento, Oracle Database con opción de almacenamiento NFS y ASM solo es compatible con la herramienta tradicional de IU del servidor de SnapCenter. Consulte link:hybrid_dbops_snapcenter_usecases.html["Soluciones de bases de datos de cloud híbrido con SnapCenter"^] Para obtener detalles sobre el backup, la restauración y el clonado de bases de datos de Oracle con la herramienta IU de NetApp SnapCenter.



== Dónde encontrar información adicional

Si quiere más información sobre la información descrita en este documento, consulte los siguientes documentos o sitios web:

* Instalación de Oracle Grid Infrastructure en un servidor independiente con una nueva instalación de base de datos
+
link:https://docs.oracle.com/en/database/oracle/oracle-database/19/ladbi/installing-oracle-grid-infrastructure-for-a-standalone-server-with-a-new-database-installation.html#GUID-0B1CEE8C-C893-46AA-8A6A-7B5FAAEC72B3["https://docs.oracle.com/en/database/oracle/oracle-database/19/ladbi/installing-oracle-grid-infrastructure-for-a-standalone-server-with-a-new-database-installation.html#GUID-0B1CEE8C-C893-46AA-8A6A-7B5FAAEC72B3"^]

* Instalación y configuración de Oracle Database con los archivos de respuesta
+
link:https://docs.oracle.com/en/database/oracle/oracle-database/19/ladbi/installing-and-configuring-oracle-database-using-response-files.html#GUID-D53355E9-E901-4224-9A2A-B882070EDDF7["https://docs.oracle.com/en/database/oracle/oracle-database/19/ladbi/installing-and-configuring-oracle-database-using-response-files.html#GUID-D53355E9-E901-4224-9A2A-B882070EDDF7"^]

* Amazon FSX para ONTAP de NetApp
+
link:https://aws.amazon.com/fsx/netapp-ontap/["https://aws.amazon.com/fsx/netapp-ontap/"^]

* Amazon EC2
+
link:https://aws.amazon.com/pm/ec2/?trk=36c6da98-7b20-48fa-8225-4784bced9843&sc_channel=ps&s_kwcid=AL!4422!3!467723097970!e!!g!!aws%20ec2&ef_id=Cj0KCQiA54KfBhCKARIsAJzSrdqwQrghn6I71jiWzSeaT9Uh1-vY-VfhJixF-xnv5rWwn2S7RqZOTQ0aAh7eEALw_wcB:G:s&s_kwcid=AL!4422!3!467723097970!e!!g!!aws%20ec2["https://aws.amazon.com/pm/ec2/?trk=36c6da98-7b20-48fa-8225-4784bced9843&sc_channel=ps&s_kwcid=AL!4422!3!467723097970!e!!g!!aws%20ec2&ef_id=Cj0KCQiA54KfBhCKARIsAJzSrdqwQrghn6I71jiWzSeaT9Uh1-vY-VfhJixF-xnv5rWwn2S7RqZOTQ0aAh7eEALw_wcB:G:s&s_kwcid=AL!4422!3!467723097970!e!!g!!aws%20ec2"^]



---
sidebar: sidebar 
permalink: databases/vcf_ora_si_vvol.html 
keywords: Database, Oracle, AWS, FSx ONTAP, VMC, VMware 
summary: 'La solución ofrece una descripción general y detalles de la implementación y la protección de Oracle en VMware Cloud Foundation (VCF) con vSphere Virtual Volumes (vVols) como almacenamiento de bases de datos principal y una configuración de Oracle Database en una instancia única (SI).' 
---
= TR-4996: Implementación y protección de Oracle SI en VCF con vVols
:hardbreaks:
:allow-uri-read: 
:nofooter: 
:icons: font
:linkattrs: 
:imagesdir: ../media/


Allen Cao, Niyaz Mohamed, NetApp

[role="lead"]
La solución ofrece una descripción general y detalles de la implementación y la protección de Oracle en VMware Cloud Foundation (VCF) con vSphere Virtual Volumes (vVols) como almacenamiento de bases de datos principal y una configuración de Oracle Database en una instancia única (SI).



== Específico

VMware vSphere Virtual Volumes (vVols) es un marco de gestión e integración de SAN/NAS que expone los discos virtuales como objetos de almacenamiento nativos y posibilita las operaciones basadas en cabinas en los discos virtuales. En otras palabras, vVols hace que los dispositivos SAN/NAS sepan equipos virtuales y libera la capacidad de aprovechar los servicios de datos basados en arreglos con un método centrado en VM con la granularidad de un único disco virtual. VVols permite a los clientes aprovechar las exclusivas funcionalidades de su inversión actual en almacenamiento y realizar una transición sin interrumpir el servicio a un modelo operativo más simple y eficiente optimizado para entornos virtuales que funcionan en todos los tipos de almacenamiento.

Esta documentación muestra la implementación y la protección de una base de datos de instancia única de Oracle en un entorno VMware Cloud Foundation con vVols como almacenamiento de base de datos principal en un clúster de almacenamiento de NetApp ONTAP. La base de datos Oracle se configura como si se desplegara en sistemas de archivos locales en un sistema de almacenamiento local. Este informe técnico se centra en los pasos de creación de vVols en la implementación de VCF para Oracle. También mostramos cómo usar la herramienta de interfaz de usuario de NetApp SnapCenter para realizar backups, restaurar y clonar una base de datos Oracle para prueba y desarrollo u otros casos prácticos para que funcione una base de datos con un uso eficiente del almacenamiento en VCF.

Esta solución aborda los siguientes casos prácticos:

* Implementación de la base de datos de Oracle SI en VCF con almacén de datos vVols en NetApp ONTAP AFF como almacenamiento de base de datos primario
* Backup y restauración de bases de datos de Oracle en VCF con almacén de datos vVols mediante la herramienta IU de NetApp SnapCenter
* Clon de bases de datos de Oracle para prueba/desarrollo u otros casos prácticos en VCF con almacén de datos vVols mediante la herramienta de interfaz de usuario de NetApp SnapCenter




== Destinatarios

Esta solución está dirigida a las siguientes personas:

* Un administrador de bases de datos que desea implementar Oracle en VCF con un almacén de datos vVols en NetApp ONTAP AFF como almacenamiento de base de datos principal
* Un arquitecto de la solución de base de datos que desee probar las cargas de trabajo de Oracle en VCF con un almacén de datos vVols en almacenamiento de NetApp ONTAP AFF
* Un administrador de almacenamiento que desea poner en funcionamiento y gestionar una base de datos Oracle desplegada en VCF con un almacén de datos vVols en un sistema de almacenamiento NetApp ONTAP AFF
* Propietario de aplicación que desea poner en marcha una base de datos de Oracle en VCF con almacén de datos VVol




== Entorno de prueba y validación de la solución

Las pruebas y la validación de esta solución se realizaron en un entorno de laboratorio con VCF con almacén de datos vVols en almacenamiento de NetApp ONTAP AFF que podría no coincidir con el entorno de puesta en marcha final. Para obtener más información, consulte la sección <<Factores clave a tener en cuenta la puesta en marcha>>.



=== Arquitectura

image:vcf_ora_si_vvols_architecture.png["Esta imagen proporciona una imagen detallada de la configuración de la puesta en marcha de Oracle en el cloud público de AWS con iSCSI y ASM."]



=== Componentes de hardware y software

[cols="33%, 33%, 33%"]
|===


3+| *Hardware* 


| NetApp ONTAP AFF A300 | Versión 9.14.1P4 | Bandeja DS224 con 24 discos NVMe, capacidad total de 35,2 TiB 


| Clúster de VMware vSphere | Versión 8,02 | 12 CPU(s) x Intel(R) Xeon(R) Gold 5218 CPU a 2,30GHz GHz, 8 nodos (4 dominios de gestión y 4 dominios de carga de trabajo) 


3+| *Software* 


| Red Hat Linux | Kernel RHEL-8,6, 4.18.0-372,9.1.el8.x86_64 | Alojamiento de servidores Oracle DB, suscripción de RedHat implementada para pruebas 


| Servidor Windows Server | 2022 Estándar, 10.0.20348 Construcción 20348 | Hospedando servidor SnapCenter 


| CentOS de Linux | CentOS Linux versión 8.5.2111 | Alojando controladora Ansible 


| Base de datos Oracle | Versión 19.18 | Parche RU aplicado p34765931_190000_Linux-x86-64.zip 


| Oracle OPatch | Versión 12.2.0.1.36 | Último parche p6880880_190000_Linux-x86-64.zip 


| Servidor SnapCenter | Versión 6,0 | Implementación de grupos de trabajo 


| Plugin de SnapCenter para VMware vSphere | Versión 6,0 | Se implementa como una máquina virtual de OVA en clúster de vSphere 


| Herramienta ONTAP para VMware vSphere | Versión 9,13 | Se implementa como una máquina virtual de OVA en clúster de vSphere 


| Abra JDK | Versión java-11-openjdk-11,0.23,0.9-3.el8.x86_64 | Requisito de complemento de SnapCenter en equipos virtuales de bases de datos 
|===


=== Configuración de Oracle Database en VCF

[cols="33%, 33%, 33%"]
|===


3+|  


| *Servidor* | *Base de datos* | *Almacenamiento de DB* 


| ora_01 | NTAP1(NTAP1_pdb1,NTAP1_pdb2,NTAP1_pdb3) | Almacenes de datos de vVols en NetApp ONTAP AFF A300 


| ora_02 | NTAP2(NTAP2_pdb1,NTAP2_pdb2,NTAP2_pdb3), NTAP1CLN | Almacenes de datos de vVols en NetApp ONTAP AFF A300 
|===


=== Factores clave a tener en cuenta la puesta en marcha

* *Protocolo para vVols a conectividad de clúster ONTAP.* NFS o iSCSI son buenas opciones. Los niveles de rendimiento son equivalentes. En esta demostración de la solución, utilizamos NFS como protocolo de almacenamiento para la conectividad vVols con el clúster de almacenamiento subrayado de ONTAP. Si la infraestructura VCF admite, también se admiten los protocolos FC/FCoE, NVMe/FC para los almacenes de datos vVols en NetApp ONTAP.
* *Diseño de almacenamiento de Oracle en vVols datastores.* En nuestras pruebas y validaciones, implementamos tres almacenes de datos vVols para archivos binarios de Oracle, datos de Oracle y archivos de registro de Oracle. Es buena práctica separar los diferentes tipos de archivos de Oracle en el almacén de datos, de modo que los procesos de backup, recuperación o clonado de la base de datos se puedan gestionar y ejecutar fácilmente. Cree vVols dedicados para grandes bases de datos y comparta vVols para bases de datos más pequeñas o bases de datos con un perfil de QoS similar. 
* *Credencial para autenticación de almacenamiento ONTAP.* Use solamente credenciales en el nivel del clúster de ONTAP para la autenticación del clúster de almacenamiento de ONTAP, incluida la conectividad de SnapCenter con el clúster de almacenamiento de ONTAP o la conectividad de la herramienta ONTAP con el clúster de almacenamiento de ONTAP.
* *Provisión de almacenamiento desde vVols datastore a la base de datos VM.* Agregue solo un disco a la vez a la máquina virtual de base de datos desde el almacén de datos vVols. No se admite actualmente la adición de varios discos desde almacenes de datos de vVols al mismo tiempo.  
* *Protección de base de datos.* NetApp ofrece una suite de software de SnapCenter para realizar backups, restauraciones y clonaciones de bases de datos con una interfaz de interfaz de usuario intuitiva. NetApp recomienda implantar esta herramienta de gestión para conseguir un backup de snapshot rápido (de menos de un minuto), una restauración rápida de base de datos y una clonación de la base de datos.




== Puesta en marcha de la solución

En las siguientes secciones se ofrecen procedimientos paso a paso para el despliegue de Oracle 19C en VCF con almacenes de datos vVols en el almacenamiento de NetApp ONTAP en una configuración de instancia única de Oracle.



=== Requisitos previos para la implementación

[%collapsible]
====
La implementación requiere los siguientes requisitos previos.

. Se configuró una VCF de VMware. Para obtener información o instrucciones sobre cómo crear un VCF, consulte la documentación de VMware link:https://docs.vmware.com/en/VMware-Cloud-Foundation/index.html["Documentación de VMware Cloud Foundation"^].
. Aprovisione tres máquinas virtuales de Linux, dos máquinas virtuales para la base de datos de Oracle y una máquina virtual para la controladora Ansible en el dominio de cargas de trabajo de VCF. Aprovisionar un equipo virtual de servidor Windows para ejecutar el servidor NetApp SnapCenter. Para obtener información sobre la configuración del controlador Ansible para la implementación automatizada de bases de datos de Oracle, consulte los siguientes recursos link:../automation/getting-started.html["Primeros pasos con la automatización de soluciones de NetApp"^].
. El complemento de SnapCenter versión 6,0 para VMware vSphere se ha puesto en marcha en VCF. Consulte los siguientes recursos para el despliegue del plugin link:https://docs.netapp.com/us-en/sc-plugin-vmware-vsphere/["Documentación del plugin de SnapCenter para VMware vSphere"^]: .
. La herramienta ONTAP para VMware vSphere se ha puesto en marcha en VCF. Consulte los siguientes recursos para la implementación de la herramienta ONTAP para VMware vSphere: link:https://docs.netapp.com/us-en/ontap-tools-vmware-vsphere/index.html["Documentación de las herramientas de ONTAP para VMware vSphere"^]



NOTE: Asegúrese de haber asignado al menos 50g en el volumen raíz de Oracle VM para tener espacio suficiente para almacenar en zona intermedia los archivos de instalación de Oracle.

====


=== Crear un perfil de capacidad de almacenamiento

[%collapsible]
====
En primer lugar, cree un perfil de funcionalidad de almacenamiento personalizado para el almacenamiento ONTAP subrayado que aloja el almacén de datos vVols.

. Desde accesos directos del cliente de vSphere, abra la herramienta NetApp ONTAP. Compruebe que se haya agregado el clúster de almacenamiento de ONTAP `Storage Systems` como parte de la puesta en marcha de la herramienta ONTAP.
+
image:vcf_ora_vvol_scp_01.png["Captura de pantalla que muestra una configuración de perfil de funcionalidades de almacenamiento personalizada."] image:vcf_ora_vvol_scp_00.png["Captura de pantalla que muestra una configuración de perfil de funcionalidades de almacenamiento personalizada."]

. Haga clic `Storage capability profile` en para agregar un perfil personalizado para Oracle. Asigne un nombre al perfil y añada una breve descripción.
+
image:vcf_ora_vvol_scp_02.png["Captura de pantalla que muestra una configuración de perfil de funcionalidades de almacenamiento personalizada."]

. Elija la categoría de controladora de almacenamiento: Rendimiento, capacidad o híbrida.
+
image:vcf_ora_vvol_scp_03.png["Captura de pantalla que muestra una configuración de perfil de funcionalidades de almacenamiento personalizada."]

. Seleccione el protocolo.
+
image:vcf_ora_vvol_scp_04.png["Captura de pantalla que muestra una configuración de perfil de funcionalidades de almacenamiento personalizada."]

. Defina una política de calidad de servicio si lo desea.
+
image:vcf_ora_vvol_scp_05.png["Captura de pantalla que muestra una configuración de perfil de funcionalidades de almacenamiento personalizada."]

. Atributos de almacenamiento adicionales para el perfil. Asegúrese de que el cifrado está activado en la controladora NetApp si desea tener la capacidad de cifrado o puede causar problemas al aplicar el perfil.
+
image:vcf_ora_vvol_scp_06.png["Captura de pantalla que muestra una configuración de perfil de funcionalidades de almacenamiento personalizada."]

. Revise el resumen y termine la creación del perfil de funcionalidad de almacenamiento.
+
image:vcf_ora_vvol_scp_07.png["Captura de pantalla que muestra una configuración de perfil de funcionalidades de almacenamiento personalizada."]



====


=== Crear y configurar el almacén de datos de vVols

[%collapsible]
====
Una vez completados los requisitos previos, inicie sesión en VCF como usuario administrador a través del cliente vSphere, navegando al dominio de la carga de trabajo. No utilice la opción de almacenamiento incorporada de VMware para crear vVols. En su lugar, utilice la herramienta NetApp ONTAP para crear vVols. A continuación, se muestran los procedimientos para crear y configurar vVols.

. El flujo de trabajo de creación de vVols se puede activar desde la interfaz de la herramienta ONTAP o desde el clúster de dominio de carga de trabajo de VCF.
+
image:vcf_ora_vvol_datastore_01.png["Captura de pantalla que muestra la configuración del almacén de datos de vVols."]

+
image:vcf_ora_vvol_datastore_01_2.png["Captura de pantalla que muestra la configuración del almacén de datos de vVols."]

. Introducción de información general para el almacén de datos, incluido el destino de aprovisionamiento, el tipo, el nombre y el protocolo.
+
image:vcf_ora_vvol_datastore_02.png["Captura de pantalla que muestra la configuración del almacén de datos de vVols."]

. Seleccione el perfil de capacidad de almacenamiento personalizado creado a partir del paso anterior, los `Storage system`y `Storage VM`, donde se van a crear los vVols.
+
image:vcf_ora_vvol_datastore_03.png["Captura de pantalla que muestra la configuración del almacén de datos de vVols."]

. Seleccione `Create new volumes`, introduzca el nombre y el tamaño del volumen y haga clic en `ADD` y, a continuación, `NEXT` para ir a la página de resumen.
+
image:vcf_ora_vvol_datastore_04.png["Captura de pantalla que muestra la configuración del almacén de datos de vVols."]

+

NOTE: Es posible añadir más de un volumen a un almacén de datos vVols o abarcar volúmenes de almacenes de datos vVols entre los nodos de controladoras ONTAP para mejorar el rendimiento.

. Haga clic `Finish` para crear el almacén de datos vVols para el binario de Oracle.
+
image:vcf_ora_vvol_datastore_05.png["Captura de pantalla que muestra la configuración del almacén de datos de vVols."]

. Repita los mismos procedimientos para crear el almacén de datos vVols para datos y log de Oracle.
+
image:vcf_ora_vvol_datastore_06.png["Captura de pantalla que muestra la configuración del almacén de datos de vVols."]




NOTE: Tenga en cuenta que cuando se clona una base de datos de Oracle, se añade otro vVols for Data a la lista vVols.

====


=== Crear una normativa de almacenamiento de VM basada en el perfil de funcionalidad de almacenamiento

[%collapsible]
====
Antes de aprovisionar el almacenamiento desde el almacén de datos vVols a la máquina virtual de base de datos, agregue una política de almacenamiento de máquina virtual basada en el perfil de funcionalidad de almacenamiento creado a partir del paso anterior. Los siguientes son los procedimientos.

. En los menús del cliente de vSphere, abra `Policies and Profiles` y resalte `VM Storage Policies`. Haga clic `Create` para abrir `VM Storage Policies` el flujo de trabajo.
+
image:vcf_ora_vvol_vm_policy_01.png["Captura de pantalla que muestra la configuración de una política de almacenamiento de la máquina virtual."]

. Asigne el nombre a la política de almacenamiento de las máquinas virtuales.
+
image:vcf_ora_vvol_vm_policy_02.png["Captura de pantalla que muestra la configuración de una política de almacenamiento de la máquina virtual."]

. En `Datastore specific rules`, comprobar `Enable rules for "NetAPP.clustered.Data.ONTAP.VP.vvol" storage`
+
image:vcf_ora_vvol_vm_policy_03.png["Captura de pantalla que muestra la configuración de una política de almacenamiento de la máquina virtual."]

. Para las reglas NetApp.clustered.Data.ONTAP.VP.vvol `Placement`, seleccione el perfil de capacidad de almacenamiento personalizado creado del paso anterior.
+
image:vcf_ora_vvol_vm_policy_04.png["Captura de pantalla que muestra la configuración de una política de almacenamiento de la máquina virtual."]

. Para las reglas de NetApp.clustered.Data.ONTAP.VP.vvol `Replication`, elija `Disabled` si no se replican los vVols.
+
image:vcf_ora_vvol_vm_policy_04_1.png["Captura de pantalla que muestra la configuración de una política de almacenamiento de la máquina virtual."]

. La página de compatibilidad del almacenamiento muestra los almacenes de datos de vVols compatibles en un entorno de VCF.
+
image:vcf_ora_vvol_vm_policy_05.png["Captura de pantalla que muestra la configuración de una política de almacenamiento de la máquina virtual."]

. Revise y termine para crear la política de almacenamiento de VM.
+
image:vcf_ora_vvol_vm_policy_06.png["Captura de pantalla que muestra la configuración de una política de almacenamiento de la máquina virtual."]

. Valide la política de almacenamiento del equipo virtual que acaba de crearse.
+
image:vcf_ora_vvol_vm_policy_07.png["Captura de pantalla que muestra la configuración de una política de almacenamiento de la máquina virtual."]



====


=== Asignar discos a VM de base de datos desde almacenes de datos vVols y configurar el almacenamiento de base de datos

[%collapsible]
====
En el cliente vSphere, añada tres discos desde los almacenes de datos de vVols a la máquina virtual de base de datos mediante la edición de la configuración de la máquina virtual. A continuación, inicie sesión en VM para formatear y montar los discos en los puntos de montaje /u01, /u02 y /u03. A continuación se muestran los pasos y tareas exactos.

. Agregar un disco a VM para el almacenamiento binario de Oracle.
+
image:vcf_ora_vvol_vm_bins.png["Captura de pantalla que muestra una configuración de almacenamiento de máquina virtual."]

. Agregar un disco al equipo virtual para el almacenamiento de datos de Oracle.
+
image:vcf_ora_vvol_vm_data.png["Captura de pantalla que muestra una configuración de almacenamiento de máquina virtual."]

. Agregar un disco a VM para el almacenamiento de registro de Oracle.
+
image:vcf_ora_vvol_vm_logs.png["Captura de pantalla que muestra una configuración de almacenamiento de máquina virtual."]

. De VM `Edit Settings`, , `Advanced Parameters`agregar atributo `disk.enableuuid` con valor `TRUE`. La VM debe estar inactiva para agregar el parámetro avanzado. Al configurar esta opción, SnapCenter podrá identificar con precisión el VVOL en su entorno.
+
image:vcf_ora_vvol_vm_uuid.png["Captura de pantalla que muestra una configuración de almacenamiento de máquina virtual."]

. Ahora, reinicie la máquina virtual. Inicie sesión en un equipo virtual como usuario administrador a través de ssh para revisar las unidades de disco que se acaban de añadir.
+
....
[admin@ora_01 ~]$ sudo fdisk -l

Disk /dev/sdb: 50 GiB, 53687091200 bytes, 104857600 sectors
Units: sectors of 1 * 512 = 512 bytes
Sector size (logical/physical): 512 bytes / 512 bytes
I/O size (minimum/optimal): 512 bytes / 512 bytes

Disk /dev/sdc: 100 GiB, 107374182400 bytes, 209715200 sectors
Units: sectors of 1 * 512 = 512 bytes
Sector size (logical/physical): 512 bytes / 512 bytes
I/O size (minimum/optimal): 512 bytes / 512 bytes

Disk /dev/sdd: 100 GiB, 107374182400 bytes, 209715200 sectors
Units: sectors of 1 * 512 = 512 bytes
Sector size (logical/physical): 512 bytes / 512 bytes
I/O size (minimum/optimal): 512 bytes / 512 bytes

.
.
.
....
. Particione las unidades como partición primaria y única simplemente aceptando las opciones predeterminadas.
+
[source, cli]
----
sudo fdisk /dev/sdb
----
+
[source, cli]
----
sudo fdisk /dev/sdc
----
+
[source, cli]
----
sudo fdisk /dev/sdd
----
. Formatee los discos particionados como sistemas de archivos xfs.
+
[source, cli]
----
sudo mkfs.xfs /dev/sdb1
----
+
[source, cli]
----
sudo mkfs.xfs /dev/sdc1
----
+
[source, cli]
----
sudo mkfs.xfs /dev/sdd1
----
. Monte las unidades en el punto de montaje /u01, /u02 y /u03.
+
[source, cli]
----
sudo mount -t xfs /dev/sdb1 /u01
----
+
[source, cli]
----
sudo mount -t xfs /dev/sdc1 /u02
----
+
[source, cli]
----
sudo mount -t xfs /dev/sdd1 /u03
----
+
....
[admin@ora_01 ~]$ df -h
Filesystem             Size  Used Avail Use% Mounted on
devtmpfs               7.7G     0  7.7G   0% /dev
tmpfs                  7.8G     0  7.8G   0% /dev/shm
tmpfs                  7.8G  782M  7.0G  10% /run
tmpfs                  7.8G     0  7.8G   0% /sys/fs/cgroup
/dev/mapper/rhel-root   44G   19G   26G  43% /
/dev/sda1             1014M  258M  757M  26% /boot
tmpfs                  1.6G   12K  1.6G   1% /run/user/42
tmpfs                  1.6G  4.0K  1.6G   1% /run/user/1000
/dev/sdb1               50G  390M   50G   1% /u01
/dev/sdc1              100G  746M  100G   1% /u02
/dev/sdd1              100G  746M  100G   1% /u03

....
. Añada puntos de montaje a /etc/fstab para que las unidades de disco se monten cuando se reinicie la máquina virtual.
+
[source, cli]
----
sudo vi /etc/fstab
----
+
....
[oracle@ora_01 ~]$ cat /etc/fstab

#
# /etc/fstab
# Created by anaconda on Wed Oct 18 19:43:31 2023
#
# Accessible filesystems, by reference, are maintained under '/dev/disk/'.
# See man pages fstab(5), findfs(8), mount(8) and/or blkid(8) for more info.
#
# After editing this file, run 'systemctl daemon-reload' to update systemd
# units generated from this file.
#
/dev/mapper/rhel-root   /                       xfs     defaults        0 0
UUID=aff942c4-b224-4b62-807d-6a5c22f7b623 /boot                   xfs     defaults        0 0
/dev/mapper/rhel-swap   none                    swap    defaults        0 0
/root/swapfile swap swap defaults 0 0
/dev/sdb1               /u01                    xfs     defaults        0 0
/dev/sdc1               /u02                    xfs     defaults        0 0
/dev/sdd1               /u03                    xfs     defaults        0 0
....


====


=== Despliegue de bases de datos de Oracle en VCF

[%collapsible]
====
Se recomienda aprovechar el kit de herramientas de automatización de NetApp para poner en marcha Oracle en VCF con vVols. Para obtener una referencia detallada sobre la ejecución del despliegue automatizado de Oracle en sistemas de archivos xfs, consulte TR-4992 link:automation_ora_c-series_nfs.html["Implementación de Oracle simplificada y automatizada en NetApp C-Series con NFS"^]: . Aunque TR-4992 incluye la puesta en marcha automática de Oracle en NetApp C-Series con NFS, es idéntica a la puesta en marcha de Oracle en VCF con vVols si se omite el montaje de sistemas de archivos NFS en máquinas virtuales de bases de datos. Simplemente omitiríamos eso con etiquetas específicas. A continuación se incluyen los procedimientos paso a paso.

. Inicie sesión en la máquina virtual de la controladora de Ansible como usuario administrador a través de SSH y clone una copia del kit de herramientas de automatización para Oracle en NFS.
+
[source, cli]
----
git clone https://bitbucket.ngage.netapp.com/scm/ns-bb/na_oracle_deploy_nfs.git
----
. Almacenar en zona intermedia los siguientes archivos de instalación de Oracle en la carpeta /tmp/archive en la VM de la base de datos. La carpeta debe permitir el acceso de todos los usuarios con el permiso 777.
+
....
LINUX.X64_193000_db_home.zip
p34765931_190000_Linux-x86-64.zip
p6880880_190000_Linux-x86-64.zip
....
. Configurar archivo de destino de despliegue - hosts, archivo de variables globales - vars/vars.yml y archivo de variables de VM de base de datos local - host_vars/host_name.yml de acuerdo con las instrucciones de esta sección de TR-4992 link:automation_ora_c-series_nfs.html#parameter-files-configuration["Configuración de archivos de parámetros"^]: . Comentar la variable nfs_lif del archivo de variables de VM de base de datos local.
. Configurar la autenticación sin clave ssh entre la controladora de Ansible y las máquinas virtuales de base de datos, lo que requiere generar un par de claves ssh y copiar la clave pública en el directorio raíz del usuario administrador de las máquinas virtuales de base de datos .ssh carpeta archivo authorized_keys.
+
[source, cli]
----
ssh-keygen
----
. Desde la controladora Ansible, directorio inicial del kit de herramientas de automatización clonado /home/admin/na_oracle_deploy_nf, ejecute la libro de estrategia de requisitos previos.
+
[source, cli]
----
ansible-playbook -i hosts 1-ansible_requirements.yml
----
. Ejecute la guía de configuración de Linux.
+
[source, cli]
----
ansible-playbook -i hosts 2-linux_config.yml -u admin -e @vars/vars.yml
----
. Ejecute el libro de estrategia de despliegue de Oracle.
+
[source, cli]
----
ansible-playbook -i hosts 4-oracle_config.yml -u admin -e @vars/vars.yml --skip-tags "ora_mount_points,enable_dnfs_client"
----
. Si lo desea, también se pueden ejecutar todos los libros de estrategia anteriores desde una única ejecución de un libro de estrategia.
+
[source, cli]
----
ansible-playbook -i hosts 0-all_playbook.yml -u admin -e @vars/vars.yml --skip-tags "ora_mount_points,enable_dnfs_client"
----
. Conéctese a EM Express para validar Oracle después de la ejecución correcta de playbook.
+
image:vcf_ora_vvol_em_02.png["Captura de pantalla que muestra la configuración de Oracle EM Express."] image:vcf_ora_vvol_em_01.png["Captura de pantalla que muestra la configuración de Oracle EM Express."]

. Opcionalmente, ejecute Destroy playbook para eliminar la base de datos de la máquina virtual de la base de datos.
+
[source, cli]
----
ansible-playbook -i hosts 5-destroy.yml -u admin -e @vars/vars.yml
----


====


=== Backup, restauración y clonación de Oracle en VCF con SnapCenter



==== Configuración de SnapCenter

[%collapsible]
====
La versión 6 de SnapCenter cuenta con numerosas mejoras de funciones respecto a la versión 5, incluida la compatibilidad con almacenes de datos VMware vVols. SnapCenter se basa en un complemento en el lado del host en una máquina virtual de base de datos para realizar actividades de gestión de protección de datos para aplicaciones. Para obtener información detallada sobre el plugin de NetApp SnapCenter para Oracle, consulte esta documentación link:https://docs.netapp.com/us-en/snapcenter/protect-sco/concept_what_you_can_do_with_the_snapcenter_plug_in_for_oracle_database.html["Qué puede hacer con el plugin para base de datos de Oracle"^]. A continuación, se proporcionan pasos generales para configurar SnapCenter versión 6 para la copia de seguridad, la recuperación y la clonación de bases de datos de Oracle en VCF.

. Descargue la versión 6 del software de SnapCenter desde el sitio de soporte de NetApp: link:https://mysupport.netapp.com/site/downloads["Descargas de soporte de NetApp"^].
. Inicie sesión en el SnapCenter que aloja Windows VM como administrador. Requisitos previos de instalación para SnapCenter 6,0.
+
image:vcf_ora_vvol_snapctr_prerequisites.png["Captura de pantalla que muestra los requisitos previos de SnapCenter 6,0."]

. Como administrador, instale el último JDK de java desde link:https://www.java.com/en/["Obtenga Java para aplicaciones de escritorio"^].
+

NOTE: Si el servidor Windows se implementa en un entorno de dominio, añada un usuario de dominio al grupo de administradores locales del servidor SnapCenter y ejecute la instalación de SnapCenter con el usuario del dominio.

. Inicie sesión en la interfaz de usuario de SnapCenter a través del puerto HTTPS 8846 como usuario de instalación para configurar SnapCenter para Oracle.
+
image:vcf_ora_vvol_snapctr_deploy_01.png["Captura de pantalla que muestra la configuración de SnapCenter."]

. Menú Revisar `Get Started` para ponerse al día en SnapCenter si usted es un nuevo usuario.
+
image:vcf_ora_vvol_snapctr_deploy_02.png["Captura de pantalla que muestra la configuración de SnapCenter."]

. Actualizar `Hypervisor Settings` en ajustes globales.
+
image:aws_ora_fsx_vmc_snapctr_01.png["Captura de pantalla que muestra la configuración de SnapCenter."]

. Añada el clúster de almacenamiento de ONTAP a `Storage Systems` mediante la IP de administración del clúster y autenticado a través de ID de usuario administrador del clúster.
+
image:vcf_ora_vvol_snapctr_deploy_06.png["Captura de pantalla que muestra la configuración de SnapCenter."] image:vcf_ora_vvol_snapctr_deploy_07.png["Captura de pantalla que muestra la configuración de SnapCenter."]

. Añada una máquina virtual de base de datos y un complemento de vSphere `Credential` para obtener acceso de SnapCenter a la máquina virtual de base de datos y a la máquina virtual del complemento de vSphere. La credencial debe tener el privilegio sudo en las máquinas virtuales de Linux. Es posible crear credenciales distintas para diferentes ID de usuario de gestión para las máquinas virtuales.
+
image:aws_ora_fsx_vmc_snapctr_03.png["Captura de pantalla que muestra la configuración de SnapCenter."]

. Agregue Oracle Database VM en VCF a `Hosts` con la credencial de DB VM creada en el paso anterior.
+
image:vcf_ora_vvol_snapctr_deploy_08.png["Captura de pantalla que muestra la configuración de SnapCenter."] image:vcf_ora_vvol_snapctr_deploy_09.png["Captura de pantalla que muestra la configuración de SnapCenter."] image:vcf_ora_vvol_snapctr_deploy_10.png["Captura de pantalla que muestra la configuración de SnapCenter."]

. Del mismo modo, agregue VM del complemento de VMware de NetApp a `Hosts` con la credencial de VM del complemento de vSphere creada en el paso anterior.
+
image:vcf_ora_vvol_snapctr_deploy_11.png["Captura de pantalla que muestra la configuración de SnapCenter."] image:vcf_ora_vvol_snapctr_deploy_12.png["Captura de pantalla que muestra la configuración de SnapCenter."]

. Finalmente, después de detectar la base de datos de Oracle en la máquina virtual de base de datos, vuelva a `Settings`-`Policies` crear políticas de backup de bases de datos de Oracle. Lo ideal es crear una normativa de backup de registros de archivo independiente que permita un intervalo de backup más frecuente para minimizar la pérdida de datos en caso de fallo.
+
image:aws_ora_fsx_vmc_snapctr_02.png["Captura de pantalla que muestra la configuración de SnapCenter."]




NOTE: Asegúrese de que el nombre del servidor SnapCenter se pueda resolver a la dirección IP de la máquina virtual de base de datos y de la máquina virtual del complemento vSphere. Del mismo modo, el nombre de la máquina virtual de la base de datos y el nombre de la máquina virtual del complemento de vSphere se pueden resolver a la dirección IP del servidor SnapCenter.

====


==== Backup de bases de datos

[%collapsible]
====
SnapCenter aprovecha la tecnología Snapshot de volumen de ONTAP para obtener backups, restauraciones o clones de bases de datos mucho más rápidos que la metodología tradicional basada en RMAN. Las copias Snapshot son coherentes con las aplicaciones, ya que se pone en modo de backup de Oracle antes de realizar una copia de Snapshot.

. Desde la `Resources` Pestaña, las bases de datos de la máquina virtual se detectan automáticamente después de que la máquina virtual se agrega a SnapCenter. Inicialmente, el estado de la base de datos se muestra como `Not protected`.
+
image:vcf_ora_vvol_snapctr_bkup_01.png["Captura de pantalla que muestra la configuración de SnapCenter."]

. Haga clic en la base de datos para iniciar un flujo de trabajo y habilitar la protección de la base de datos.
+
image:vcf_ora_vvol_snapctr_bkup_02.png["Captura de pantalla que muestra la configuración de SnapCenter."]

. Aplique la política de backup y configure la programación si es necesario.
+
image:vcf_ora_vvol_snapctr_bkup_03.png["Captura de pantalla que muestra la configuración de SnapCenter."]

. Configurar notificación de trabajo de copia de seguridad si es necesario.
+
image:vcf_ora_vvol_snapctr_bkup_05.png["Captura de pantalla que muestra la configuración de SnapCenter."]

. Revise el resumen y termine para habilitar la protección de bases de datos.
+
image:vcf_ora_vvol_snapctr_bkup_06.png["Captura de pantalla que muestra la configuración de SnapCenter."]

. El trabajo de copia de seguridad bajo demanda se puede activar haciendo clic en `Back up Now`.
+
image:vcf_ora_vvol_snapctr_bkup_07.png["Captura de pantalla que muestra la configuración de SnapCenter."] image:vcf_ora_vvol_snapctr_bkup_08.png["Captura de pantalla que muestra la configuración de SnapCenter."]

. El trabajo de copia de seguridad se puede supervisar en el `Monitor` haciendo clic en el trabajo en ejecución.
+
image:vcf_ora_vvol_snapctr_bkup_09.png["Captura de pantalla que muestra la configuración de SnapCenter."]

. Haga clic en DATABASE para revisar los conjuntos de copias de seguridad completados para cada base de datos.
+
image:vcf_ora_vvol_snapctr_bkup_10.png["Captura de pantalla que muestra la configuración de SnapCenter."]



====


==== Restauración/recuperación de bases de datos

[%collapsible]
====
SnapCenter ofrece diversas opciones de restauración y recuperación para bases de datos de Oracle a partir de un backup de snapshots. En este ejemplo, mostramos que restaura desde un backup Snapshot antiguo y, a continuación, se reenvía la base de datos al último registro disponible.

. En primer lugar, ejecute un backup de snapshot. A continuación, cree una tabla de prueba e inserte una fila en la tabla para validar la base de datos recuperada de la imagen de instantánea antes de que la creación de la tabla de prueba recupere la tabla de prueba.
+
....
[oracle@ora_01 ~]$ sqlplus / as sysdba

SQL*Plus: Release 19.0.0.0.0 - Production on Wed Jul 17 10:20:10 2024
Version 19.18.0.0.0

Copyright (c) 1982, 2022, Oracle.  All rights reserved.


Connected to:
Oracle Database 19c Enterprise Edition Release 19.0.0.0.0 - Production
Version 19.18.0.0.0

SQL> sho pdbs

    CON_ID CON_NAME                       OPEN MODE  RESTRICTED
---------- ------------------------------ ---------- ----------
         2 PDB$SEED                       READ ONLY  NO
         3 NTAP1_PDB1                     READ WRITE NO
         4 NTAP1_PDB2                     READ WRITE NO
         5 NTAP1_PDB3                     READ WRITE NO
SQL> alter session set container=ntap1_pdb1;

SQL> select * from test;

no rows selected


SQL> insert into test values (1, sysdate, 'test oracle backup/restore/clone on VMware Cloud Foundation vVols');

1 row created.

SQL> commit;

Commit complete.

SQL> select * from test;

        ID
----------
DT
---------------------------------------------------------------------------
EVENT
--------------------------------------------------------------------------------
         1
18-JUL-24 11.15.03.000000 AM
test oracle backup/restore/clone on VMware Cloud Foundation vVols


SQL>


....
. En la pestaña SnapCenter `Resources` , abra la página de topología de backup Database NTAP1. Destaque el juego de copias de seguridad de datos de instantánea antes de la creación de la tabla de prueba. Haga clic en `Restore` para iniciar el flujo de trabajo de restauración-recuperación.
+
image:vcf_ora_vvol_snapctr_restore_01.png["Captura de pantalla que muestra la configuración de SnapCenter."]

. Seleccione Restore Scope.
+
image:vcf_ora_vvol_snapctr_restore_02.png["Captura de pantalla que muestra la configuración de SnapCenter."]

. Seleccione el ámbito de recuperación en `All Logs`.
+
image:vcf_ora_vvol_snapctr_restore_03.png["Captura de pantalla que muestra la configuración de SnapCenter."]

. Especifique los scripts previos opcionales que se van a ejecutar.
+
image:vcf_ora_vvol_snapctr_restore_04.png["Captura de pantalla que muestra la configuración de SnapCenter."]

. Especifique el archivo after-script opcional que se va a ejecutar.
+
image:vcf_ora_vvol_snapctr_restore_05.png["Captura de pantalla que muestra la configuración de SnapCenter."]

. Envíe un informe de trabajo si lo desea.
+
image:vcf_ora_vvol_snapctr_restore_06.png["Captura de pantalla que muestra la configuración de SnapCenter."]

. Revise el resumen y haga clic en `Finish` para iniciar la restauración y recuperación.
+
image:vcf_ora_vvol_snapctr_restore_07.png["Captura de pantalla que muestra la configuración de SnapCenter."]

. De `Monitor` abra el trabajo para revisar los detalles.
+
image:vcf_ora_vvol_snapctr_restore_08.png["Captura de pantalla que muestra la configuración de SnapCenter."]

. Desde la máquina virtual de la base de datos ora_01, validar que la restauración/recuperación correcta de la base de datos se haya reenviado a su estado más reciente y que se haya recuperado la tabla de pruebas.
+
....

[oracle@ora_01 ~]$ sqlplus / as sysdba

SQL*Plus: Release 19.0.0.0.0 - Production on Thu Jul 18 11:42:58 2024
Version 19.18.0.0.0

Copyright (c) 1982, 2022, Oracle.  All rights reserved.


Connected to:
Oracle Database 19c Enterprise Edition Release 19.0.0.0.0 - Production
Version 19.18.0.0.0

SQL> select name, open_mode from v$database;

NAME      OPEN_MODE
--------- --------------------
NTAP1     READ WRITE

SQL> alter session set container=ntap1_pdb1;

Session altered.

SQL> select * from test;

        ID
----------
DT
---------------------------------------------------------------------------
EVENT
--------------------------------------------------------------------------------
         1
18-JUL-24 11.15.03.000000 AM
test oracle backup/restore/clone on VMware Cloud Foundation vVols


SQL>


....


====


==== Clon de la base de datos

[%collapsible]
====
En este ejemplo, los juegos de backup más recientes se utilizan para clonar una base de datos en el equipo virtual de la base de datos ora_02 en una instalación de software diferente y ORACLE_HOME en VCF.

. De nuevo, abra la lista de copias de seguridad de la base de datos NTAP1. Seleccione el conjunto de backup de datos más reciente, haga clic en `Clone` el botón para iniciar el flujo de trabajo de clonado de base de datos.
+
image:vcf_ora_vvol_snapctr_clone_01.png["Captura de pantalla que muestra la configuración de SnapCenter."]

. Asigne el nombre al SID de la base de datos del clon.
+
image:vcf_ora_vvol_snapctr_clone_02.png["Captura de pantalla que muestra la configuración de SnapCenter."]

. Seleccione ora_02 en VCF como host de clonación de la base de datos de destino. Se debe haber instalado y configurado un software de base de datos Oracle idéntico en el host.
+
image:vcf_ora_vvol_snapctr_clone_03.png["Captura de pantalla que muestra la configuración de SnapCenter."]

. Seleccione el ORACLE_HOME, el usuario y el grupo adecuados en el host de destino. Mantener la credencial por defecto.
+
image:vcf_ora_vvol_snapctr_clone_04.png["Captura de pantalla que muestra la configuración de SnapCenter."]

. Es posible cambiar los parámetros de la base de datos del clon para cumplir con los requisitos de configuración o recursos de la base de datos del clon.
+
image:vcf_ora_vvol_snapctr_clone_05.png["Captura de pantalla que muestra la configuración de SnapCenter."]

. Elija el ámbito de recuperación. `Until Cancel` recupera el clon hasta el último archivo de registro disponible en el conjunto de backup.
+
image:vcf_ora_vvol_snapctr_clone_06.png["Captura de pantalla que muestra la configuración de SnapCenter."]

. Revise el resumen e inicie el trabajo de clonado.
+
image:vcf_ora_vvol_snapctr_clone_08.png["Captura de pantalla que muestra la configuración de SnapCenter."]

. Supervise la ejecución del trabajo de clonado desde `Monitor` pestaña.
+
image:vcf_ora_vvol_snapctr_clone_09.png["Captura de pantalla que muestra la configuración de SnapCenter."]

. La base de datos clonada se registra inmediatamente en SnapCenter.
+
image:vcf_ora_vvol_snapctr_clone_10.png["Captura de pantalla que muestra la configuración de SnapCenter."]

. Desde la DB VM ora_02, valide la base de datos clonada y consulte la tabla de prueba.
+
....
[oracle@ora_02 ~]$ sqlplus / as sysdba

SQL*Plus: Release 19.0.0.0.0 - Production on Thu Jul 18 12:06:48 2024
Version 19.18.0.0.0

Copyright (c) 1982, 2022, Oracle.  All rights reserved.


Connected to:
Oracle Database 19c Enterprise Edition Release 19.0.0.0.0 - Production
Version 19.18.0.0.0

SQL> select name, open_mode, log_mode from v$database;

NAME      OPEN_MODE            LOG_MODE
--------- -------------------- ------------
NTAP1CLN  READ WRITE           ARCHIVELOG

SQL> select instance_name, host_name from v$instance;

INSTANCE_NAME
----------------
HOST_NAME
----------------------------------------------------------------
NTAP1CLN
ora_02


SQL> show pdbs

    CON_ID CON_NAME                       OPEN MODE  RESTRICTED
---------- ------------------------------ ---------- ----------
         2 PDB$SEED                       READ ONLY  NO
         3 NTAP1_PDB1                     READ WRITE NO
         4 NTAP1_PDB2                     READ WRITE NO
         5 NTAP1_PDB3                     READ WRITE NO
SQL> alter session set container=ntap1_pdb1
  2  ;

Session altered.

SQL> select * from test;

        ID
----------
DT
---------------------------------------------------------------------------
EVENT
--------------------------------------------------------------------------------
         1
18-JUL-24 11.15.03.000000 AM
test oracle backup/restore/clone on VMware Cloud Foundation vVols


SQL>

....


Esto completa la demostración del backup, la restauración y el clon de la base de datos de Oracle en VCF de SnapCenter.

====


== Dónde encontrar información adicional

Si quiere más información sobre la información descrita en este documento, consulte los siguientes documentos o sitios web:

* link:https://www.vmware.com/products/cloud-infrastructure/vmware-cloud-foundation["Base de cloud de VMware"^]
* link:index.html["Soluciones de bases de datos empresariales de NetApp"^]
* link:https://docs.netapp.com/us-en/snapcenter/concept/concept_snapcenter_overview.html["Software SnapCenter 6.0"^]

